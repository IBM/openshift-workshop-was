/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["depot.AddressController"]){dojo._hasResource["depot.AddressController"]=true;dojo.provide("depot.AddressController");dojo.require("dijit.form.Form");dojo.require("dijit.TitlePane");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.FilteringSelect");dojo.require("dojo.data.ItemFileReadStore");dojo.require("dojox.form.BusyButton");dojo.declare("depot.AddressController",[],{constructor:function(){console.debug("Address Controller");dojo.subscribe(accountController.ACCOUNT_LOAD,this,this.setEvents);dojo.subscribe(accountController.ACCOUNT_LOAD,this,this.setAddress);dojo.connect(dijit.byId("account"),"onLoad",this,this.setAddress);dojo.connect(dijit.byId("account"),"onLoad",this,this.setEvents);dojo.query(".formValue","addressForm").forEach(dojo.hitch(this,function(_1){dojo.connect(_1,"onchange",this,this.isValid);dojo.connect(_1,"onkeyup",this,this.isValid);}));},setEvents:function(){dojo.connect(dijit.byId("updateAddressButton"),"onClick",this,this.updateAddress);},setAddress:function(){console.debug("setting address");if(accountController.account&&accountController.account.address){console.dir(accountController.account.address);dijit.byId("addressForm").set("value",accountController.account.address);console.debug("address Set");}},isValid:function(){if(dijit.byId("addressForm").isValid()){dijit.byId("updateAddressButton").set("disabled",false);return true;}else{dijit.byId("updateAddressButton").set("disabled",true);return false;}},updateAddress:function(){console.debug("Updating Address");dojo.query("input").forEach(dojo.hitch(this,function(_2){_2.disabled=true;}));dijit.byId("updateAddressButton").makeBusy();var _3={url:"jaxrs/Customer/Address",headers:{"Content-Type":"application/json"},putData:dojo.toJson(dijit.byId("addressForm").get("value")),load:dojo.hitch(this,this.updateAddressSuccess),error:dojo.hitch(this,this.updateAddressError)};dojo.xhrPut(_3);},updateAddressSuccess:function(_4){console.info("Update Success");accountController.account.address=dijit.byId("addressForm").get("value");dojo.query("input").forEach(dojo.hitch(this,function(_5){_5.disabled=true;}));dijit.byId("updateAddressButton").cancel();dojo.place("<div class='successMessage'>Address Update Succesful</div>","result","only");},updateAddressError:function(e){console.error("Error Loading Account",e);dojo.query("input").forEach(dojo.hitch(this,function(_6){_6.disabled=false;}));dijit.byId("updateAddressButton").cancel();dojo.place("<div class='errorMessage'>Address Update Failed</div>","result","only");}});}
/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["dojox.data.ServiceStore"]){dojo._hasResource["dojox.data.ServiceStore"]=true;dojo.provide("dojox.data.ServiceStore");dojo.declare("dojox.data.ServiceStore",dojox.data.ClientFilter||null,{service:null,constructor:function(_1){this.byId=this.fetchItemByIdentity;this._index={};if(_1){dojo.mixin(this,_1);}this.idAttribute=(_1&&_1.idAttribute)||(this.schema&&this.schema._idAttr);},schema:null,idAttribute:"id",labelAttribute:"label",syncMode:false,estimateCountFactor:1,getSchema:function(){return this.schema;},loadLazyValues:true,getValue:function(_2,_3,_4){var _5=_2[_3];return _5||(_3 in _2?_5:_2._loadObject?(dojox.rpc._sync=true)&&arguments.callee.call(this,dojox.data.ServiceStore.prototype.loadItem({item:_2})||{},_3,_4):_4);},getValues:function(_6,_7){var _8=this.getValue(_6,_7);if(_8 instanceof Array){return _8;}if(!this.isItemLoaded(_8)){dojox.rpc._sync=true;_8=this.loadItem({item:_8});}return _8 instanceof Array?_8:_8===undefined?[]:[_8];},getAttributes:function(_9){var _a=[];for(var i in _9){if(_9.hasOwnProperty(i)&&!(i.charAt(0)=="_"&&i.charAt(1)=="_")){_a.push(i);}}return _a;},hasAttribute:function(_b,_c){return _c in _b;},containsValue:function(_d,_e,_f){return dojo.indexOf(this.getValues(_d,_e),_f)>-1;},isItem:function(_10){return (typeof _10=="object")&&_10&&!(_10 instanceof Date);},isItemLoaded:function(_11){return _11&&!_11._loadObject;},loadItem:function(_12){var _13;if(_12.item._loadObject){_12.item._loadObject(function(_14){_13=_14;delete _13._loadObject;var _15=_14 instanceof Error?_12.onError:_12.onItem;if(_15){_15.call(_12.scope,_14);}});}else{if(_12.onItem){_12.onItem.call(_12.scope,_12.item);}}return _13;},_currentId:0,_processResults:function(_16,_17){if(_16&&typeof _16=="object"){var id=_16.__id;if(!id){if(this.idAttribute){id=_16[this.idAttribute];}else{id=this._currentId++;}if(id!==undefined){var _18=this._index[id];if(_18){for(var j in _18){delete _18[j];}_16=dojo.mixin(_18,_16);}_16.__id=id;this._index[id]=_16;}}for(var i in _16){_16[i]=this._processResults(_16[i],_17).items;}var _19=_16.length;}return {totalCount:_17.request.count==_19?(_17.request.start||0)+_19*this.estimateCountFactor:_19,items:_16};},close:function(_1a){return _1a&&_1a.abort&&_1a.abort();},fetch:function(_1b){_1b=_1b||{};if("syncMode" in _1b?_1b.syncMode:this.syncMode){dojox.rpc._sync=true;}var _1c=this;var _1d=_1b.scope||_1c;var _1e=this.cachingFetch?this.cachingFetch(_1b):this._doQuery(_1b);_1e.request=_1b;_1e.addCallback(function(_1f){if(_1b.clientFetch){_1f=_1c.clientSideFetch({query:_1b.clientFetch,sort:_1b.sort,start:_1b.start,count:_1b.count},_1f);}var _20=_1c._processResults(_1f,_1e);_1f=_1b.results=_20.items;if(_1b.onBegin){_1b.onBegin.call(_1d,_20.totalCount,_1b);}if(_1b.onItem){for(var i=0;i<_1f.length;i++){_1b.onItem.call(_1d,_1f[i],_1b);}}if(_1b.onComplete){_1b.onComplete.call(_1d,_1b.onItem?null:_1f,_1b);}return _1f;});_1e.addErrback(_1b.onError&&function(err){return _1b.onError.call(_1d,err,_1b);});_1b.abort=function(){_1e.cancel();};_1b.store=this;return _1b;},_doQuery:function(_21){var _22=typeof _21.queryStr=="string"?_21.queryStr:_21.query;return this.service(_22);},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true,"dojo.data.api.Schema":this.schema};},getLabel:function(_23){return this.getValue(_23,this.labelAttribute);},getLabelAttributes:function(_24){return [this.labelAttribute];},getIdentity:function(_25){return _25.__id;},getIdentityAttributes:function(_26){return [this.idAttribute];},fetchItemByIdentity:function(_27){var _28=this._index[(_27._prefix||"")+_27.identity];if(_28){if(_28._loadObject){_27.item=_28;return this.loadItem(_27);}else{if(_27.onItem){_27.onItem.call(_27.scope,_28);}}}else{return this.fetch({query:_27.identity,onComplete:_27.onItem,onError:_27.onError,scope:_27.scope}).results;}return _28;}});}if(!dojo._hasResource["dojox.json.ref"]){dojo._hasResource["dojox.json.ref"]=true;dojo.provide("dojox.json.ref");dojox.json.ref={resolveJson:function(_29,_2a){_2a=_2a||{};var _2b=_2a.idAttribute||"id";var _2c=this.refAttribute;var _2d=_2a.idAsRef;var _2e=_2a.idPrefix||"";var _2f=_2a.assignAbsoluteIds;var _30=_2a.index||{};var _31=_2a.timeStamps;var ref,_32=[];var _33=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/;var _34=this._addProp;var F=function(){};function _35(it,_36,_37,_38,_39,_3a){var i,_3b,val,id=_2b in it?it[_2b]:_37;if(_2b in it||((id!==undefined)&&_38)){id=(_2e+id).replace(_33,"$2$3");}var _3c=_3a||it;if(id!==undefined){if(_2f){it.__id=id;}if(_2a.schemas&&(!(it instanceof Array))&&(val=id.match(/^(.+\/)[^\.\[]*$/))){_39=_2a.schemas[val[1]];}if(_30[id]&&((it instanceof Array)==(_30[id] instanceof Array))){_3c=_30[id];delete _3c.$ref;delete _3c._loadObject;_3b=true;}else{var _3d=_39&&_39.prototype;if(_3d){F.prototype=_3d;_3c=new F();}}_30[id]=_3c;if(_31){_31[id]=_2a.time;}}while(_39){var _3e=_39.properties;if(_3e){for(i in it){var _3f=_3e[i];if(_3f&&_3f.format=="date-time"&&typeof it[i]=="string"){it[i]=dojo.date.stamp.fromISOString(it[i]);}}}_39=_39["extends"];}var _40=it.length;for(i in it){if(i==_40){break;}if(it.hasOwnProperty(i)){val=it[i];if((typeof val=="object")&&val&&!(val instanceof Date)&&i!="__parent"){ref=val[_2c]||(_2d&&val[_2b]);if(!ref||!val.__parent){if(it!=_32){val.__parent=_3c;}}if(ref){delete it[i];var _41=ref.toString().replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/);if((ref=(_41[1]=="$"||_41[1]=="this"||_41[1]=="")?_29:_30[(_2e+_41[1]).replace(_33,"$2$3")])){if(_41[3]){_41[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(t,a,b,c,d){ref=ref&&ref[b?b.replace(/[\"\'\\]/,""):d];});}}if(ref){val=ref;}else{if(!_36){var _42;if(!_42){_32.push(_3c);}_42=true;val=_35(val,false,val[_2c],true,_3f);val._loadObject=_2a.loader;}}}else{if(!_36){val=_35(val,_32==it,id===undefined?undefined:_34(id,i),false,_3f,_3c!=it&&typeof _3c[i]=="object"&&_3c[i]);}}}it[i]=val;if(_3c!=it&&!_3c.__isDirty){var old=_3c[i];_3c[i]=val;if(_3b&&val!==old&&!_3c._loadObject&&!(i.charAt(0)=="_"&&i.charAt(1)=="_")&&i!="$ref"&&!(val instanceof Date&&old instanceof Date&&val.getTime()==old.getTime())&&!(typeof val=="function"&&typeof old=="function"&&val.toString()==old.toString())&&_30.onUpdate){_30.onUpdate(_3c,i,old,val);}}}}if(_3b&&(_2b in it||_3c instanceof Array)){for(i in _3c){if(!_3c.__isDirty&&_3c.hasOwnProperty(i)&&!it.hasOwnProperty(i)&&!(i.charAt(0)=="_"&&i.charAt(1)=="_")&&!(_3c instanceof Array&&isNaN(i))){if(_30.onUpdate&&i!="_loadObject"&&i!="_idAttr"){_30.onUpdate(_3c,i,_3c[i],undefined);}delete _3c[i];while(_3c instanceof Array&&_3c.length&&_3c[_3c.length-1]===undefined){_3c.length--;}}}}else{if(_30.onLoad){_30.onLoad(_3c);}}return _3c;};if(_29&&typeof _29=="object"){_29=_35(_29,false,_2a.defaultId,true);_35(_32,false);}return _29;},fromJson:function(str,_43){function ref(_44){var _45={};_45[this.refAttribute]=_44;return _45;};try{var _46=eval("("+str+")");}catch(e){throw new SyntaxError("Invalid JSON string: "+e.message+" parsing: "+str);}if(_46){return this.resolveJson(_46,_43);}return _46;},toJson:function(it,_47,_48,_49){var _4a=this._useRefs;var _4b=this._addProp;var _4c=this.refAttribute;_48=_48||"";var _4d={};var _4e={};function _4f(it,_50,_51){if(typeof it=="object"&&it){var _52;if(it instanceof Date){return "\""+dojo.date.stamp.toISOString(it,{zulu:true})+"\"";}var id=it.__id;if(id){if(_50!="#"&&((_4a&&!id.match(/#/))||_4d[id])){var ref=id;if(id.charAt(0)!="#"){if(it.__clientId==id){ref="cid:"+id;}else{if(id.substring(0,_48.length)==_48){ref=id.substring(_48.length);}else{ref=id;}}}var _53={};_53[_4c]=ref;return _4f(_53,"#");}_50=id;}else{it.__id=_50;_4e[_50]=it;}_4d[_50]=it;_51=_51||"";var _54=_47?_51+dojo.toJsonIndentStr:"";var _55=_47?"\n":"";var sep=_47?" ":"";if(it instanceof Array){var res=dojo.map(it,function(obj,i){var val=_4f(obj,_4b(_50,i),_54);if(typeof val!="string"){val="undefined";}return _55+_54+val;});return "["+res.join(","+sep)+_55+_51+"]";}var _56=[];for(var i in it){if(it.hasOwnProperty(i)){var _57;if(typeof i=="number"){_57="\""+i+"\"";}else{if(typeof i=="string"&&(i.charAt(0)!="_"||i.charAt(1)!="_")){_57=dojo._escapeString(i);}else{continue;}}var val=_4f(it[i],_4b(_50,i),_54);if(typeof val!="string"){continue;}_56.push(_55+_54+_57+":"+sep+val);}}return "{"+_56.join(","+sep)+_55+_51+"}";}else{if(typeof it=="function"&&dojox.json.ref.serializeFunctions){return it.toString();}}return dojo.toJson(it);};var _58=_4f(it,"#","");if(!_49){for(var i in _4e){delete _4e[i].__id;}}return _58;},_addProp:function(id,_59){return id+(id.match(/#/)?id.length==1?"":".":"#")+_59;},refAttribute:"$ref",_useRefs:false,serializeFunctions:false};}if(!dojo._hasResource["dojox.rpc.Rest"]){dojo._hasResource["dojox.rpc.Rest"]=true;dojo.provide("dojox.rpc.Rest");(function(){if(dojox.rpc&&dojox.rpc.transportRegistry){dojox.rpc.transportRegistry.register("REST",function(str){return str=="REST";},{getExecutor:function(_5a,_5b,svc){return new dojox.rpc.Rest(_5b.name,(_5b.contentType||svc._smd.contentType||"").match(/json|javascript/),null,function(id,_5c){var _5d=svc._getRequest(_5b,[id]);_5d.url=_5d.target+(_5d.data?"?"+_5d.data:"");return _5d;});}});}var drr;function _5e(_5f,_60,_61,id){_5f.addCallback(function(_62){if(_5f.ioArgs.xhr&&_61){_61=_5f.ioArgs.xhr.getResponseHeader("Content-Range");_5f.fullLength=_61&&(_61=_61.match(/\/(.*)/))&&parseInt(_61[1]);}return _62;});return _5f;};drr=dojox.rpc.Rest=function(_63,_64,_65,_66){var _67;_67=function(id,_68){return drr._get(_67,id,_68);};_67.isJson=_64;_67._schema=_65;_67.cache={serialize:_64?((dojox.json&&dojox.json.ref)||dojo).toJson:function(_69){return _69;}};_67._getRequest=_66||function(id,_6a){if(dojo.isObject(id)){id=dojo.objectToQuery(id);id=id?"?"+id:"";}if(_6a&&_6a.sort&&!_6a.queryStr){id+=(id?"&":"?")+"sort(";for(var i=0;i<_6a.sort.length;i++){var _6b=_6a.sort[i];id+=(i>0?",":"")+(_6b.descending?"-":"+")+encodeURIComponent(_6b.attribute);}id+=")";}var _6c={url:_63+(id==null?"":id),handleAs:_64?"json":"text",contentType:_64?"application/json":"text/plain",sync:dojox.rpc._sync,headers:{Accept:_64?"application/json,application/javascript":"*/*"}};if(_6a&&(_6a.start>=0||_6a.count>=0)){_6c.headers.Range="items="+(_6a.start||"0")+"-"+((_6a.count&&_6a.count!=Infinity&&(_6a.count+(_6a.start||0)-1))||"");}dojox.rpc._sync=false;return _6c;};function _6d(_6e){_67[_6e]=function(id,_6f){return drr._change(_6e,_67,id,_6f);};};_6d("put");_6d("post");_6d("delete");_67.servicePath=_63;return _67;};drr._index={};drr._timeStamps={};drr._change=function(_70,_71,id,_72){var _73=_71._getRequest(id);_73[_70+"Data"]=_72;return _5e(dojo.xhr(_70.toUpperCase(),_73,true),_71);};drr._get=function(_74,id,_75){_75=_75||{};return _5e(dojo.xhrGet(_74._getRequest(id,_75)),_74,(_75.start>=0||_75.count>=0),id);};})();}if(!dojo._hasResource["dojox.rpc.JsonRest"]){dojo._hasResource["dojox.rpc.JsonRest"]=true;dojo.provide("dojox.rpc.JsonRest");(function(){var _76=[];var _77=dojox.rpc.Rest;var jr;function _78(_79,_7a,_7b,_7c){var _7d=_7a.ioArgs&&_7a.ioArgs.xhr&&_7a.ioArgs.xhr.getResponseHeader("Last-Modified");if(_7d&&_77._timeStamps){_77._timeStamps[_7c]=_7d;}var _7e=_79._schema&&_79._schema.hrefProperty;if(_7e){dojox.json.ref.refAttribute=_7e;}_7b=_7b&&dojox.json.ref.resolveJson(_7b,{defaultId:_7c,index:_77._index,timeStamps:_7d&&_77._timeStamps,time:_7d,idPrefix:_79.servicePath.replace(/[^\/]*$/,""),idAttribute:jr.getIdAttribute(_79),schemas:jr.schemas,loader:jr._loader,idAsRef:_79.idAsRef,assignAbsoluteIds:true});dojox.json.ref.refAttribute="$ref";return _7b;};jr=dojox.rpc.JsonRest={serviceClass:dojox.rpc.Rest,conflictDateHeader:"If-Unmodified-Since",commit:function(_7f){_7f=_7f||{};var _80=[];var _81={};var _82=[];for(var i=0;i<_76.length;i++){var _83=_76[i];var _84=_83.object;var old=_83.old;var _85=false;if(!(_7f.service&&(_84||old)&&(_84||old).__id.indexOf(_7f.service.servicePath))&&_83.save){delete _84.__isDirty;if(_84){if(old){var _86;if((_86=_84.__id.match(/(.*)#.*/))){_84=_77._index[_86[1]];}if(!(_84.__id in _81)){_81[_84.__id]=_84;if(_7f.incrementalUpdates&&!_86){var _87=(typeof _7f.incrementalUpdates=="function"?_7f.incrementalUpdates:function(){_87={};for(var j in _84){if(_84.hasOwnProperty(j)){if(_84[j]!==old[j]){_87[j]=_84[j];}}else{if(old.hasOwnProperty(j)){return null;}}}return _87;})(_84,old);}if(_87){_80.push({method:"post",target:_84,content:_87});}else{_80.push({method:"put",target:_84,content:_84});}}}else{var _88=jr.getServiceAndId(_84.__id).service;var _89=jr.getIdAttribute(_88);if((_89 in _84)&&!_7f.alwaysPostNewItems){_80.push({method:"put",target:_84,content:_84});}else{_80.push({method:"post",target:{__id:_88.servicePath},content:_84});}}}else{if(old){_80.push({method:"delete",target:old});}}_82.push(_83);_76.splice(i--,1);}}dojo.connect(_7f,"onError",function(){if(_7f.revertOnError!==false){var _8a=_76;_76=_82;var _8b=0;jr.revert();_76=_8a;}else{_76=dirtyObject.concat(_82);}});jr.sendToServer(_80,_7f);return _80;},sendToServer:function(_8c,_8d){var _8e;var _8f=dojo.xhr;var _90=_8c.length;var i,_91;var _92;var _93=this.conflictDateHeader;dojo.xhr=function(_94,_95){_95.headers=_95.headers||{};_95.headers["Transaction"]=_8c.length-1==i?"commit":"open";if(_93&&_92){_95.headers[_93]=_92;}if(_91){_95.headers["Content-ID"]="<"+_91+">";}return _8f.apply(dojo,arguments);};for(i=0;i<_8c.length;i++){var _96=_8c[i];dojox.rpc.JsonRest._contentId=_96.content&&_96.content.__id;var _97=_96.method=="post";_92=_96.method=="put"&&_77._timeStamps[_96.content.__id];if(_92){_77._timeStamps[_96.content.__id]=(new Date())+"";}_91=_97&&dojox.rpc.JsonRest._contentId;var _98=jr.getServiceAndId(_96.target.__id);var _99=_98.service;var dfd=_96.deferred=_99[_96.method](_98.id.replace(/#/,""),dojox.json.ref.toJson(_96.content,false,_99.servicePath,true));(function(_9a,dfd,_9b){dfd.addCallback(function(_9c){try{var _9d=dfd.ioArgs.xhr&&dfd.ioArgs.xhr.getResponseHeader("Location");if(_9d){var _9e=_9d.match(/(^\w+:\/\/)/)&&_9d.indexOf(_9b.servicePath);_9d=_9e>0?_9d.substring(_9e):(_9b.servicePath+_9d).replace(/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,"$2$3");_9a.__id=_9d;_77._index[_9d]=_9a;}_9c=_78(_9b,dfd,_9c,_9a&&_9a.__id);}catch(e){}if(!(--_90)){if(_8d.onComplete){_8d.onComplete.call(_8d.scope,_8c);}}return _9c;});})(_96.content,dfd,_99);dfd.addErrback(function(_9f){_90=-1;_8d.onError.call(_8d.scope,_9f);});}dojo.xhr=_8f;},getDirtyObjects:function(){return _76;},revert:function(_a0){for(var i=_76.length;i>0;){i--;var _a1=_76[i];var _a2=_a1.object;var old=_a1.old;var _a3=dojox.data._getStoreForItem(_a2||old);if(!(_a0&&(_a2||old)&&(_a2||old).__id.indexOf(_a0.servicePath))){if(_a2&&old){for(var j in old){if(old.hasOwnProperty(j)&&_a2[j]!==old[j]){if(_a3){_a3.onSet(_a2,j,_a2[j],old[j]);}_a2[j]=old[j];}}for(j in _a2){if(!old.hasOwnProperty(j)){if(_a3){_a3.onSet(_a2,j,_a2[j]);}delete _a2[j];}}}else{if(!old){if(_a3){_a3.onDelete(_a2);}}else{if(_a3){_a3.onNew(old);}}}delete (_a2||old).__isDirty;_76.splice(i,1);}}},changing:function(_a4,_a5){if(!_a4.__id){return;}_a4.__isDirty=true;for(var i=0;i<_76.length;i++){var _a6=_76[i];if(_a4==_a6.object){if(_a5){_a6.object=false;if(!this._saveNotNeeded){_a6.save=true;}}return;}}var old=_a4 instanceof Array?[]:{};for(i in _a4){if(_a4.hasOwnProperty(i)){old[i]=_a4[i];}}_76.push({object:!_a5&&_a4,old:old,save:!this._saveNotNeeded});},deleteObject:function(_a7){this.changing(_a7,true);},getConstructor:function(_a8,_a9){if(typeof _a8=="string"){var _aa=_a8;_a8=new dojox.rpc.Rest(_a8,true);this.registerService(_a8,_aa,_a9);}if(_a8._constructor){return _a8._constructor;}_a8._constructor=function(_ab){var _ac=this;var _ad=arguments;var _ae;var _af;function _b0(_b1){if(_b1){_b0(_b1["extends"]);_ae=_b1.properties;for(var i in _ae){var _b2=_ae[i];if(_b2&&(typeof _b2=="object")&&("default" in _b2)){_ac[i]=_b2["default"];}}}if(_b1&&_b1.prototype&&_b1.prototype.initialize){_af=true;_b1.prototype.initialize.apply(_ac,_ad);}};_b0(_a8._schema);if(!_af&&_ab&&typeof _ab=="object"){dojo.mixin(_ac,_ab);}var _b3=jr.getIdAttribute(_a8);_77._index[this.__id=this.__clientId=_a8.servicePath+(this[_b3]||Math.random().toString(16).substring(2,14)+"@"+((dojox.rpc.Client&&dojox.rpc.Client.clientId)||"client"))]=this;if(dojox.json.schema&&_ae){dojox.json.schema.mustBeValid(dojox.json.schema.validate(this,_a8._schema));}_76.push({object:this,save:true});};return dojo.mixin(_a8._constructor,_a8._schema,{load:_a8});},fetch:function(_b4){var _b5=jr.getServiceAndId(_b4);return this.byId(_b5.service,_b5.id);},getIdAttribute:function(_b6){var _b7=_b6._schema;var _b8;if(_b7){if(!(_b8=_b7._idAttr)){for(var i in _b7.properties){if(_b7.properties[i].identity||(_b7.properties[i].link=="self")){_b7._idAttr=_b8=i;}}}}return _b8||"id";},getServiceAndId:function(_b9){var _ba="";for(var _bb in jr.services){if((_b9.substring(0,_bb.length)==_bb)&&(_bb.length>=_ba.length)){_ba=_bb;}}if(_ba){return {service:jr.services[_ba],id:_b9.substring(_ba.length)};}var _bc=_b9.match(/^(.*\/)([^\/]*)$/);return {service:new jr.serviceClass(_bc[1],true),id:_bc[2]};},services:{},schemas:{},registerService:function(_bd,_be,_bf){_be=_bd.servicePath=_be||_bd.servicePath;_bd._schema=jr.schemas[_be]=_bf||_bd._schema||{};jr.services[_be]=_bd;},byId:function(_c0,id){var _c1,_c2=_77._index[(_c0.servicePath||"")+id];if(_c2&&!_c2._loadObject){_c1=new dojo.Deferred();_c1.callback(_c2);return _c1;}return this.query(_c0,id);},query:function(_c3,id,_c4){var _c5=_c3(id,_c4);_c5.addCallback(function(_c6){if(_c6.nodeType&&_c6.cloneNode){return _c6;}return _78(_c3,_c5,_c6,typeof id!="string"||(_c4&&(_c4.start||_c4.count))?undefined:id);});return _c5;},_loader:function(_c7){var _c8=jr.getServiceAndId(this.__id);var _c9=this;jr.query(_c8.service,_c8.id).addBoth(function(_ca){if(_ca==_c9){delete _ca.$ref;delete _ca._loadObject;}else{_c9._loadObject=function(_cb){_cb(_ca);};}_c7(_ca);});},isDirty:function(_cc){if(!_cc){return !!_76.length;}return _cc.__isDirty;}};})();}if(!dojo._hasResource["dojox.data.JsonRestStore"]){dojo._hasResource["dojox.data.JsonRestStore"]=true;dojo.provide("dojox.data.JsonRestStore");dojo.declare("dojox.data.JsonRestStore",dojox.data.ServiceStore,{constructor:function(_cd){dojo.connect(dojox.rpc.Rest._index,"onUpdate",this,function(obj,_ce,_cf,_d0){var _d1=this.service.servicePath;if(!obj.__id){console.log("no id on updated object ",obj);}else{if(obj.__id.substring(0,_d1.length)==_d1){this.onSet(obj,_ce,_cf,_d0);}}});this.idAttribute=this.idAttribute||"id";if(typeof _cd.target=="string"){_cd.target=_cd.target.match(/\/$/)||this.allowNoTrailingSlash?_cd.target:(_cd.target+"/");if(!this.service){this.service=dojox.rpc.JsonRest.services[_cd.target]||dojox.rpc.Rest(_cd.target,true);}}dojox.rpc.JsonRest.registerService(this.service,_cd.target,this.schema);this.schema=this.service._schema=this.schema||this.service._schema||{};this.service._store=this;this.service.idAsRef=this.idAsRef;this.schema._idAttr=this.idAttribute;var _d2=dojox.rpc.JsonRest.getConstructor(this.service);var _d3=this;this._constructor=function(_d4){_d2.call(this,_d4);_d3.onNew(this);};this._constructor.prototype=_d2.prototype;this._index=dojox.rpc.Rest._index;},loadReferencedSchema:true,idAsRef:false,referenceIntegrity:true,target:"",allowNoTrailingSlash:false,newItem:function(_d5,_d6){_d5=new this._constructor(_d5);if(_d6){var _d7=this.getValue(_d6.parent,_d6.attribute,[]);_d7=_d7.concat([_d5]);_d5.__parent=_d7;this.setValue(_d6.parent,_d6.attribute,_d7);}return _d5;},deleteItem:function(_d8){var _d9=[];var _da=dojox.data._getStoreForItem(_d8)||this;if(this.referenceIntegrity){dojox.rpc.JsonRest._saveNotNeeded=true;var _db=dojox.rpc.Rest._index;var _dc=function(_dd){var _de;_d9.push(_dd);_dd.__checked=1;for(var i in _dd){if(i.substring(0,2)!="__"){var _df=_dd[i];if(_df==_d8){if(_dd!=_db){if(_dd instanceof Array){(_de=_de||[]).push(i);}else{(dojox.data._getStoreForItem(_dd)||_da).unsetAttribute(_dd,i);}}}else{if((typeof _df=="object")&&_df){if(!_df.__checked){_dc(_df);}if(typeof _df.__checked=="object"&&_dd!=_db){(dojox.data._getStoreForItem(_dd)||_da).setValue(_dd,i,_df.__checked);}}}}}if(_de){i=_de.length;_dd=_dd.__checked=_dd.concat();while(i--){_dd.splice(_de[i],1);}return _dd;}return null;};_dc(_db);dojox.rpc.JsonRest._saveNotNeeded=false;var i=0;while(_d9[i]){delete _d9[i++].__checked;}}dojox.rpc.JsonRest.deleteObject(_d8);_da.onDelete(_d8);},changing:function(_e0,_e1){dojox.rpc.JsonRest.changing(_e0,_e1);},setValue:function(_e2,_e3,_e4){var old=_e2[_e3];var _e5=_e2.__id?dojox.data._getStoreForItem(_e2):this;if(dojox.json.schema&&_e5.schema&&_e5.schema.properties){dojox.json.schema.mustBeValid(dojox.json.schema.checkPropertyChange(_e4,_e5.schema.properties[_e3]));}if(_e3==_e5.idAttribute){throw new Error("Can not change the identity attribute for an item");}_e5.changing(_e2);_e2[_e3]=_e4;if(_e4&&!_e4.__parent){_e4.__parent=_e2;}_e5.onSet(_e2,_e3,old,_e4);},setValues:function(_e6,_e7,_e8){if(!dojo.isArray(_e8)){throw new Error("setValues expects to be passed an Array object as its value");}this.setValue(_e6,_e7,_e8);},unsetAttribute:function(_e9,_ea){this.changing(_e9);var old=_e9[_ea];delete _e9[_ea];this.onSet(_e9,_ea,old,undefined);},save:function(_eb){if(!(_eb&&_eb.global)){(_eb=_eb||{}).service=this.service;}if("syncMode" in _eb?_eb.syncMode:this.syncMode){dojox.rpc._sync=true;}var _ec=dojox.rpc.JsonRest.commit(_eb);this.serverVersion=this._updates&&this._updates.length;return _ec;},revert:function(_ed){dojox.rpc.JsonRest.revert(_ed&&_ed.global&&this.service);},isDirty:function(_ee){return dojox.rpc.JsonRest.isDirty(_ee);},isItem:function(_ef,_f0){return _ef&&_ef.__id&&(_f0||this.service==dojox.rpc.JsonRest.getServiceAndId(_ef.__id).service);},_doQuery:function(_f1){var _f2=typeof _f1.queryStr=="string"?_f1.queryStr:_f1.query;var _f3=dojox.rpc.JsonRest.query(this.service,_f2,_f1);var _f4=this;if(this.loadReferencedSchema){_f3.addCallback(function(_f5){var _f6=_f3.ioArgs&&_f3.ioArgs.xhr&&_f3.ioArgs.xhr.getResponseHeader("Content-Type");var _f7=_f6&&_f6.match(/definedby\s*=\s*([^;]*)/);if(_f6&&!_f7){_f7=_f3.ioArgs.xhr.getResponseHeader("Link");_f7=_f7&&_f7.match(/<([^>]*)>;\s*rel="?definedby"?/);}_f7=_f7&&_f7[1];if(_f7){var _f8=dojox.rpc.JsonRest.getServiceAndId((_f4.target+_f7).replace(/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,"$2$3"));var _f9=dojox.rpc.JsonRest.byId(_f8.service,_f8.id);_f9.addCallbacks(function(_fa){dojo.mixin(_f4.schema,_fa);return _f5;},function(_fb){console.error(_fb);return _f5;});return _f9;}return undefined;});}return _f3;},_processResults:function(_fc,_fd){var _fe=_fc.length;return {totalCount:_fd.fullLength||(_fd.request.count==_fe?(_fd.request.start||0)+_fe*2:_fe),items:_fc};},getConstructor:function(){return this._constructor;},getIdentity:function(_ff){var id=_ff.__clientId||_ff.__id;if(!id){return id;}var _100=this.service.servicePath.replace(/[^\/]*$/,"");return id.substring(0,_100.length)!=_100?id:id.substring(_100.length);},fetchItemByIdentity:function(args){var id=args.identity;var _101=this;if(id.toString().match(/^(\w*:)?\//)){var _102=dojox.rpc.JsonRest.getServiceAndId(id);_101=_102.service._store;args.identity=_102.id;}args._prefix=_101.service.servicePath.replace(/[^\/]*$/,"");return _101.inherited(arguments);},onSet:function(){},onNew:function(){},onDelete:function(){},getFeatures:function(){var _103=this.inherited(arguments);_103["dojo.data.api.Write"]=true;_103["dojo.data.api.Notification"]=true;return _103;},getParent:function(item){return item&&item.__parent;}});dojox.data.JsonRestStore.getStore=function(_104,_105){if(typeof _104.target=="string"){_104.target=_104.target.match(/\/$/)||_104.allowNoTrailingSlash?_104.target:(_104.target+"/");var _106=(dojox.rpc.JsonRest.services[_104.target]||{})._store;if(_106){return _106;}}return new (_105||dojox.data.JsonRestStore)(_104);};dojox.data._getStoreForItem=function(item){if(item.__id){var _107=dojox.rpc.JsonRest.getServiceAndId(item.__id);if(_107&&_107.service._store){return _107.service._store;}else{var _108=item.__id.toString().match(/.*\//)[0];return new dojox.data.JsonRestStore({target:_108});}}return null;};dojox.json.ref._useRefs=true;}if(!dojo._hasResource["dojo.fx.Toggler"]){dojo._hasResource["dojo.fx.Toggler"]=true;dojo.provide("dojo.fx.Toggler");dojo.declare("dojo.fx.Toggler",null,{node:null,showFunc:dojo.fadeIn,hideFunc:dojo.fadeOut,showDuration:200,hideDuration:200,constructor:function(args){var _109=this;dojo.mixin(_109,args);_109.node=args.node;_109._showArgs=dojo.mixin({},args);_109._showArgs.node=_109.node;_109._showArgs.duration=_109.showDuration;_109.showAnim=_109.showFunc(_109._showArgs);_109._hideArgs=dojo.mixin({},args);_109._hideArgs.node=_109.node;_109._hideArgs.duration=_109.hideDuration;_109.hideAnim=_109.hideFunc(_109._hideArgs);dojo.connect(_109.showAnim,"beforeBegin",dojo.hitch(_109.hideAnim,"stop",true));dojo.connect(_109.hideAnim,"beforeBegin",dojo.hitch(_109.showAnim,"stop",true));},show:function(_10a){return this.showAnim.play(_10a||0);},hide:function(_10b){return this.hideAnim.play(_10b||0);}});}if(!dojo._hasResource["dojo.fx"]){dojo._hasResource["dojo.fx"]=true;dojo.provide("dojo.fx");(function(){var d=dojo,_10c={_fire:function(evt,args){if(this[evt]){this[evt].apply(this,args||[]);}return this;}};var _10d=function(_10e){this._index=-1;this._animations=_10e||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;d.forEach(this._animations,function(a){this.duration+=a.duration;if(a.delay){this.duration+=a.delay;}},this);};d.extend(_10d,{_onAnimate:function(){this._fire("onAnimate",arguments);},_onEnd:function(){d.disconnect(this._onAnimateCtx);d.disconnect(this._onEndCtx);this._onAnimateCtx=this._onEndCtx=null;if(this._index+1==this._animations.length){this._fire("onEnd");}else{this._current=this._animations[++this._index];this._onAnimateCtx=d.connect(this._current,"onAnimate",this,"_onAnimate");this._onEndCtx=d.connect(this._current,"onEnd",this,"_onEnd");this._current.play(0,true);}},play:function(_10f,_110){if(!this._current){this._current=this._animations[this._index=0];}if(!_110&&this._current.status()=="playing"){return this;}var _111=d.connect(this._current,"beforeBegin",this,function(){this._fire("beforeBegin");}),_112=d.connect(this._current,"onBegin",this,function(arg){this._fire("onBegin",arguments);}),_113=d.connect(this._current,"onPlay",this,function(arg){this._fire("onPlay",arguments);d.disconnect(_111);d.disconnect(_112);d.disconnect(_113);});if(this._onAnimateCtx){d.disconnect(this._onAnimateCtx);}this._onAnimateCtx=d.connect(this._current,"onAnimate",this,"_onAnimate");if(this._onEndCtx){d.disconnect(this._onEndCtx);}this._onEndCtx=d.connect(this._current,"onEnd",this,"_onEnd");this._current.play.apply(this._current,arguments);return this;},pause:function(){if(this._current){var e=d.connect(this._current,"onPause",this,function(arg){this._fire("onPause",arguments);d.disconnect(e);});this._current.pause();}return this;},gotoPercent:function(_114,_115){this.pause();var _116=this.duration*_114;this._current=null;d.some(this._animations,function(a){if(a.duration<=_116){this._current=a;return true;}_116-=a.duration;return false;});if(this._current){this._current.gotoPercent(_116/this._current.duration,_115);}return this;},stop:function(_117){if(this._current){if(_117){for(;this._index+1<this._animations.length;++this._index){this._animations[this._index].stop(true);}this._current=this._animations[this._index];}var e=d.connect(this._current,"onStop",this,function(arg){this._fire("onStop",arguments);d.disconnect(e);});this._current.stop();}return this;},status:function(){return this._current?this._current.status():"stopped";},destroy:function(){if(this._onAnimateCtx){d.disconnect(this._onAnimateCtx);}if(this._onEndCtx){d.disconnect(this._onEndCtx);}}});d.extend(_10d,_10c);dojo.fx.chain=function(_118){return new _10d(_118);};var _119=function(_11a){this._animations=_11a||[];this._connects=[];this._finished=0;this.duration=0;d.forEach(_11a,function(a){var _11b=a.duration;if(a.delay){_11b+=a.delay;}if(this.duration<_11b){this.duration=_11b;}this._connects.push(d.connect(a,"onEnd",this,"_onEnd"));},this);this._pseudoAnimation=new d.Animation({curve:[0,1],duration:this.duration});var self=this;d.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],function(evt){self._connects.push(d.connect(self._pseudoAnimation,evt,function(){self._fire(evt,arguments);}));});};d.extend(_119,{_doAction:function(_11c,args){d.forEach(this._animations,function(a){a[_11c].apply(a,args);});return this;},_onEnd:function(){if(++this._finished>this._animations.length){this._fire("onEnd");}},_call:function(_11d,args){var t=this._pseudoAnimation;t[_11d].apply(t,args);},play:function(_11e,_11f){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this;},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this;},gotoPercent:function(_120,_121){var ms=this.duration*_120;d.forEach(this._animations,function(a){a.gotoPercent(a.duration<ms?1:(ms/a.duration),_121);});this._call("gotoPercent",arguments);return this;},stop:function(_122){this._doAction("stop",arguments);this._call("stop",arguments);return this;},status:function(){return this._pseudoAnimation.status();},destroy:function(){d.forEach(this._connects,dojo.disconnect);}});d.extend(_119,_10c);dojo.fx.combine=function(_123){return new _119(_123);};dojo.fx.wipeIn=function(args){var node=args.node=d.byId(args.node),s=node.style,o;var anim=d.animateProperty(d.mixin({properties:{height:{start:function(){o=s.overflow;s.overflow="hidden";if(s.visibility=="hidden"||s.display=="none"){s.height="1px";s.display="";s.visibility="";return 1;}else{var _124=d.style(node,"height");return Math.max(_124,1);}},end:function(){return node.scrollHeight;}}}},args));d.connect(anim,"onEnd",function(){s.height="auto";s.overflow=o;});return anim;};dojo.fx.wipeOut=function(args){var node=args.node=d.byId(args.node),s=node.style,o;var anim=d.animateProperty(d.mixin({properties:{height:{end:1}}},args));d.connect(anim,"beforeBegin",function(){o=s.overflow;s.overflow="hidden";s.display="";});d.connect(anim,"onEnd",function(){s.overflow=o;s.height="auto";s.display="none";});return anim;};dojo.fx.slideTo=function(args){var node=args.node=d.byId(args.node),top=null,left=null;var init=(function(n){return function(){var cs=d.getComputedStyle(n);var pos=cs.position;top=(pos=="absolute"?n.offsetTop:parseInt(cs.top)||0);left=(pos=="absolute"?n.offsetLeft:parseInt(cs.left)||0);if(pos!="absolute"&&pos!="relative"){var ret=d.position(n,true);top=ret.y;left=ret.x;n.style.position="absolute";n.style.top=top+"px";n.style.left=left+"px";}};})(node);init();var anim=d.animateProperty(d.mixin({properties:{top:args.top||0,left:args.left||0}},args));d.connect(anim,"beforeBegin",anim,init);return anim;};})();}if(!dojo._hasResource["dijit.tree.TreeStoreModel"]){dojo._hasResource["dijit.tree.TreeStoreModel"]=true;dojo.provide("dijit.tree.TreeStoreModel");dojo.declare("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:false,constructor:function(args){dojo.mixin(this,args);this.connects=[];var _125=this.store;if(!_125.getFeatures()["dojo.data.api.Identity"]){throw new Error("dijit.Tree: store must support dojo.data.Identity");}if(_125.getFeatures()["dojo.data.api.Notification"]){this.connects=this.connects.concat([dojo.connect(_125,"onNew",this,"onNewItem"),dojo.connect(_125,"onDelete",this,"onDeleteItem"),dojo.connect(_125,"onSet",this,"onSetItem")]);}},destroy:function(){dojo.forEach(this.connects,dojo.disconnect);},getRoot:function(_126,_127){if(this.root){_126(this.root);}else{this.store.fetch({query:this.query,onComplete:dojo.hitch(this,function(_128){if(_128.length!=1){throw new Error(this.declaredClass+": query "+dojo.toJson(this.query)+" returned "+_128.length+" items, but must return exactly one item");}this.root=_128[0];_126(this.root);}),onError:_127});}},mayHaveChildren:function(item){return dojo.some(this.childrenAttrs,function(attr){return this.store.hasAttribute(item,attr);},this);},getChildren:function(_129,_12a,_12b){var _12c=this.store;if(!_12c.isItemLoaded(_129)){var _12d=dojo.hitch(this,arguments.callee);_12c.loadItem({item:_129,onItem:function(_12e){_12d(_12e,_12a,_12b);},onError:_12b});return;}var _12f=[];for(var i=0;i<this.childrenAttrs.length;i++){var vals=_12c.getValues(_129,this.childrenAttrs[i]);_12f=_12f.concat(vals);}var _130=0;if(!this.deferItemLoadingUntilExpand){dojo.forEach(_12f,function(item){if(!_12c.isItemLoaded(item)){_130++;}});}if(_130==0){_12a(_12f);}else{dojo.forEach(_12f,function(item,idx){if(!_12c.isItemLoaded(item)){_12c.loadItem({item:item,onItem:function(item){_12f[idx]=item;if(--_130==0){_12a(_12f);}},onError:_12b});}});}},isItem:function(_131){return this.store.isItem(_131);},fetchItemByIdentity:function(_132){this.store.fetchItemByIdentity(_132);},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){if(this.labelAttr){return this.store.getValue(item,this.labelAttr);}else{return this.store.getLabel(item);}},newItem:function(args,_133,_134){var _135={parent:_133,attribute:this.childrenAttrs[0],insertIndex:_134};if(this.newItemIdAttr&&args[this.newItemIdAttr]){this.fetchItemByIdentity({identity:args[this.newItemIdAttr],scope:this,onItem:function(item){if(item){this.pasteItem(item,null,_133,true,_134);}else{this.store.newItem(args,_135);}}});}else{this.store.newItem(args,_135);}},pasteItem:function(_136,_137,_138,_139,_13a){var _13b=this.store,_13c=this.childrenAttrs[0];if(_137){dojo.forEach(this.childrenAttrs,function(attr){if(_13b.containsValue(_137,attr,_136)){if(!_139){var _13d=dojo.filter(_13b.getValues(_137,attr),function(x){return x!=_136;});_13b.setValues(_137,attr,_13d);}_13c=attr;}});}if(_138){if(typeof _13a=="number"){var _13e=_13b.getValues(_138,_13c).slice();_13e.splice(_13a,0,_136);_13b.setValues(_138,_13c,_13e);}else{_13b.setValues(_138,_13c,_13b.getValues(_138,_13c).concat(_136));}}},onChange:function(item){},onChildrenChange:function(_13f,_140){},onDelete:function(_141,_142){},onNewItem:function(item,_143){if(!_143){return;}this.getChildren(_143.item,dojo.hitch(this,function(_144){this.onChildrenChange(_143.item,_144);}));},onDeleteItem:function(item){this.onDelete(item);},onSetItem:function(item,_145,_146,_147){if(dojo.indexOf(this.childrenAttrs,_145)!=-1){this.getChildren(item,dojo.hitch(this,function(_148){this.onChildrenChange(item,_148);}));}else{this.onChange(item);}}});}if(!dojo._hasResource["dijit.tree.ForestStoreModel"]){dojo._hasResource["dijit.tree.ForestStoreModel"]=true;dojo.provide("dijit.tree.ForestStoreModel");dojo.declare("dijit.tree.ForestStoreModel",dijit.tree.TreeStoreModel,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(_149){this.root={store:this,root:true,id:_149.rootId,label:_149.rootLabel,children:_149.rootChildren};},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_14a,_14b,_14c){if(_14a===this.root){if(this.root.children){_14b(this.root.children);}else{this.store.fetch({query:this.query,onComplete:dojo.hitch(this,function(_14d){this.root.children=_14d;_14b(_14d);}),onError:_14c});}}else{this.inherited(arguments);}},isItem:function(_14e){return (_14e===this.root)?true:this.inherited(arguments);},fetchItemByIdentity:function(_14f){if(_14f.identity==this.root.id){var _150=_14f.scope?_14f.scope:dojo.global;if(_14f.onItem){_14f.onItem.call(_150,this.root);}}else{this.inherited(arguments);}},getIdentity:function(item){return (item===this.root)?this.root.id:this.inherited(arguments);},getLabel:function(item){return (item===this.root)?this.root.label:this.inherited(arguments);},newItem:function(args,_151,_152){if(_151===this.root){this.onNewRootItem(args);return this.store.newItem(args);}else{return this.inherited(arguments);}},onNewRootItem:function(args){},pasteItem:function(_153,_154,_155,_156,_157){if(_154===this.root){if(!_156){this.onLeaveRoot(_153);}}dijit.tree.TreeStoreModel.prototype.pasteItem.call(this,_153,_154===this.root?null:_154,_155===this.root?null:_155,_156,_157);if(_155===this.root){this.onAddToRoot(_153);}},onAddToRoot:function(item){console.log(this,": item ",item," added to root");},onLeaveRoot:function(item){console.log(this,": item ",item," removed from root");},_requeryTop:function(){var _158=this.root.children||[];this.store.fetch({query:this.query,onComplete:dojo.hitch(this,function(_159){this.root.children=_159;if(_158.length!=_159.length||dojo.some(_158,function(item,idx){return _159[idx]!=item;})){this.onChildrenChange(this.root,_159);}})});},onNewItem:function(item,_15a){this._requeryTop();this.inherited(arguments);},onDeleteItem:function(item){if(dojo.indexOf(this.root.children,item)!=-1){this._requeryTop();}this.inherited(arguments);}});}if(!dojo._hasResource["dijit.Tree"]){dojo._hasResource["dijit.Tree"]=true;dojo.provide("dijit.Tree");dojo.declare("dijit._TreeNode",[dijit._Widget,dijit._Templated,dijit._Container,dijit._Contained,dijit._CssStateMixin],{item:null,isTreeNode:true,label:"",isExpandable:null,isExpanded:false,state:"UNCHECKED",templateString:dojo.cache("dijit","templates/TreeNode.html","<div class=\"dijitTreeNode\" waiRole=\"presentation\"\n\t><div dojoAttachPoint=\"rowNode\" class=\"dijitTreeRow\" waiRole=\"presentation\" dojoAttachEvent=\"onmouseenter:_onMouseEnter, onmouseleave:_onMouseLeave, onclick:_onClick, ondblclick:_onDblClick\"\n\t\t><img src=\"${_blankGif}\" alt=\"\" dojoAttachPoint=\"expandoNode\" class=\"dijitTreeExpando\" waiRole=\"presentation\"\n\t\t/><span dojoAttachPoint=\"expandoNodeText\" class=\"dijitExpandoText\" waiRole=\"presentation\"\n\t\t></span\n\t\t><span dojoAttachPoint=\"contentNode\"\n\t\t\tclass=\"dijitTreeContent\" waiRole=\"presentation\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" dojoAttachPoint=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" waiRole=\"presentation\"\n\t\t\t/><span dojoAttachPoint=\"labelNode\" class=\"dijitTreeLabel\" wairole=\"treeitem\" tabindex=\"-1\" waiState=\"selected-false\" dojoAttachEvent=\"onfocus:_onLabelFocus\"></span>\n\t\t</span\n\t></div>\n\t<div dojoAttachPoint=\"containerNode\" class=\"dijitTreeContainer\" waiRole=\"presentation\" style=\"display: none;\"></div>\n</div>\n"),baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow",labelNode:"dijitTreeLabel"},attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{label:{node:"labelNode",type:"innerText"},tooltip:{node:"rowNode",type:"attribute",attribute:"title"}}),postCreate:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);if(this.isExpandable){dijit.setWaiState(this.labelNode,"expanded",this.isExpanded);}},_setIndentAttr:function(_15b){this.indent=_15b;var _15c=(Math.max(_15b,0)*this.tree._nodePixelIndent)+"px";dojo.style(this.domNode,"backgroundPosition",_15c+" 0px");dojo.style(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",_15c);dojo.forEach(this.getChildren(),function(_15d){_15d.set("indent",_15b+1);});},markProcessing:function(){this.state="LOADING";this._setExpando(true);},unmarkProcessing:function(){this._setExpando(false);},_updateItemClasses:function(item){var tree=this.tree,_15e=tree.model;if(tree._v10Compat&&item===_15e.root){item=null;}this._applyClassAndStyle(item,"icon","Icon");this._applyClassAndStyle(item,"label","Label");this._applyClassAndStyle(item,"row","Row");},_applyClassAndStyle:function(item,_15f,_160){var _161="_"+_15f+"Class";var _162=_15f+"Node";if(this[_161]){dojo.removeClass(this[_162],this[_161]);}this[_161]=this.tree["get"+_160+"Class"](item,this.isExpanded);if(this[_161]){dojo.addClass(this[_162],this[_161]);}dojo.style(this[_162],this.tree["get"+_160+"Style"](item,this.isExpanded)||{});},_updateLayout:function(){var _163=this.getParent();if(!_163||_163.rowNode.style.display=="none"){dojo.addClass(this.domNode,"dijitTreeIsRoot");}else{dojo.toggleClass(this.domNode,"dijitTreeIsLast",!this.getNextSibling());}},_setExpando:function(_164){var _165=["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"],_166=["*","-","+","*"],idx=_164?0:(this.isExpandable?(this.isExpanded?1:2):3);dojo.removeClass(this.expandoNode,_165);dojo.addClass(this.expandoNode,_165[idx]);this.expandoNodeText.innerHTML=_166[idx];},expand:function(){if(this._expandDeferred){return this._expandDeferred;}this._wipeOut&&this._wipeOut.stop();this.isExpanded=true;dijit.setWaiState(this.labelNode,"expanded","true");dijit.setWaiRole(this.containerNode,"group");dojo.addClass(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);if(this==this.tree.rootNode){dijit.setWaiState(this.tree.domNode,"expanded","true");}var def,_167=dojo.fx.wipeIn({node:this.containerNode,duration:dijit.defaultDuration,onEnd:function(){def.callback(true);}});def=(this._expandDeferred=new dojo.Deferred(function(){_167.stop();}));_167.play();return def;},collapse:function(){if(!this.isExpanded){return;}if(this._expandDeferred){this._expandDeferred.cancel();delete this._expandDeferred;}this.isExpanded=false;dijit.setWaiState(this.labelNode,"expanded","false");if(this==this.tree.rootNode){dijit.setWaiState(this.tree.domNode,"expanded","false");}dojo.removeClass(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);if(!this._wipeOut){this._wipeOut=dojo.fx.wipeOut({node:this.containerNode,duration:dijit.defaultDuration});}this._wipeOut.play();},indent:0,setChildItems:function(_168){var tree=this.tree,_169=tree.model,defs=[];dojo.forEach(this.getChildren(),function(_16a){dijit._Container.prototype.removeChild.call(this,_16a);},this);this.state="LOADED";if(_168&&_168.length>0){this.isExpandable=true;dojo.forEach(_168,function(item){var id=_169.getIdentity(item),_16b=tree._itemNodesMap[id],node;if(_16b){for(var i=0;i<_16b.length;i++){if(_16b[i]&&!_16b[i].getParent()){node=_16b[i];node.set("indent",this.indent+1);break;}}}if(!node){node=this.tree._createTreeNode({item:item,tree:tree,isExpandable:_169.mayHaveChildren(item),label:tree.getLabel(item),tooltip:tree.getTooltip(item),dir:tree.dir,lang:tree.lang,indent:this.indent+1});if(_16b){_16b.push(node);}else{tree._itemNodesMap[id]=[node];}}this.addChild(node);if(this.tree.autoExpand||this.tree._state(item)){defs.push(tree._expandNode(node));}},this);dojo.forEach(this.getChildren(),function(_16c,idx){_16c._updateLayout();});}else{this.isExpandable=false;}if(this._setExpando){this._setExpando(false);}this._updateItemClasses(this.item);if(this==tree.rootNode){var fc=this.tree.showRoot?this:this.getChildren()[0];if(fc){fc.setFocusable(true);tree.lastFocused=fc;}else{tree.domNode.setAttribute("tabIndex","0");}}return new dojo.DeferredList(defs);},removeChild:function(node){this.inherited(arguments);var _16d=this.getChildren();if(_16d.length==0){this.isExpandable=false;this.collapse();}dojo.forEach(_16d,function(_16e){_16e._updateLayout();});},makeExpandable:function(){this.isExpandable=true;this._setExpando(false);},_onLabelFocus:function(evt){this.tree._onNodeFocus(this);},setSelected:function(_16f){dijit.setWaiState(this.labelNode,"selected",_16f);dojo.toggleClass(this.rowNode,"dijitTreeRowSelected",_16f);},setFocusable:function(_170){this.labelNode.setAttribute("tabIndex",_170?"0":"-1");},_onClick:function(evt){this.tree._onClick(this,evt);},_onDblClick:function(evt){this.tree._onDblClick(this,evt);},_onMouseEnter:function(evt){this.tree._onNodeMouseEnter(this,evt);},_onMouseLeave:function(evt){this.tree._onNodeMouseLeave(this,evt);}});dojo.declare("dijit.Tree",[dijit._Widget,dijit._Templated],{store:null,model:null,query:null,label:"",showRoot:true,childrenAttr:["children"],path:[],selectedItem:null,openOnClick:false,openOnDblClick:false,templateString:dojo.cache("dijit","templates/Tree.html","<div class=\"dijitTree dijitTreeContainer\" waiRole=\"tree\"\n\tdojoAttachEvent=\"onkeypress:_onKeyPress\">\n\t<div class=\"dijitInline dijitTreeIndent\" style=\"position: absolute; top: -9999px\" dojoAttachPoint=\"indentDetector\"></div>\n</div>\n"),persist:true,autoExpand:false,dndController:null,dndParams:["onDndDrop","itemCreator","onDndCancel","checkAcceptance","checkItemAcceptance","dragThreshold","betweenThreshold"],onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(_171,_172){dojo.publish(this.id,[dojo.mixin({tree:this,event:_171},_172||{})]);},postMixInProperties:function(){this.tree=this;if(this.autoExpand){this.persist=false;}this._itemNodesMap={};if(!this.cookieName){this.cookieName=this.id+"SaveStateCookie";}this._loadDeferred=new dojo.Deferred();this.inherited(arguments);},postCreate:function(){this._initState();if(!this.model){this._store2model();}this.connect(this.model,"onChange","_onItemChange");this.connect(this.model,"onChildrenChange","_onItemChildrenChange");this.connect(this.model,"onDelete","_onItemDelete");this._load();this.inherited(arguments);if(this.dndController){if(dojo.isString(this.dndController)){this.dndController=dojo.getObject(this.dndController);}var _173={};for(var i=0;i<this.dndParams.length;i++){if(this[this.dndParams[i]]){_173[this.dndParams[i]]=this[this.dndParams[i]];}}this.dndController=new this.dndController(this,_173);}},_store2model:function(){this._v10Compat=true;dojo.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var _174={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};if(this.params.mayHaveChildren){_174.mayHaveChildren=dojo.hitch(this,"mayHaveChildren");}if(this.params.getItemChildren){_174.getChildren=dojo.hitch(this,function(item,_175,_176){this.getItemChildren((this._v10Compat&&item===this.model.root)?null:item,_175,_176);});}this.model=new dijit.tree.ForestStoreModel(_174);this.showRoot=Boolean(this.label);},onLoad:function(){},_load:function(){this.model.getRoot(dojo.hitch(this,function(item){var rn=(this.rootNode=this.tree._createTreeNode({item:item,tree:this,isExpandable:true,label:this.label||this.getLabel(item),indent:this.showRoot?0:-1}));if(!this.showRoot){rn.rowNode.style.display="none";}this.domNode.appendChild(rn.domNode);var _177=this.model.getIdentity(item);if(this._itemNodesMap[_177]){this._itemNodesMap[_177].push(rn);}else{this._itemNodesMap[_177]=[rn];}rn._updateLayout();this._expandNode(rn).addCallback(dojo.hitch(this,function(){this._loadDeferred.callback(true);this.onLoad();}));}),function(err){console.error(this,": error loading root: ",err);});},getNodesByItem:function(item){if(!item){return [];}var _178=dojo.isString(item)?item:this.model.getIdentity(item);return [].concat(this._itemNodesMap[_178]);},_setSelectedItemAttr:function(item){var _179=this.get("selectedItem");var _17a=(!item||dojo.isString(item))?item:this.model.getIdentity(item);if(_17a==_179?this.model.getIdentity(_179):null){return;}var _17b=this._itemNodesMap[_17a];this._selectNode((_17b&&_17b[0])||null);},_getSelectedItemAttr:function(){return this.selectedNode&&this.selectedNode.item;},_setPathAttr:function(path){var d=new dojo.Deferred();this._selectNode(null);if(!path||!path.length){d.resolve(true);return d;}this._loadDeferred.addCallback(dojo.hitch(this,function(){if(!this.rootNode){d.reject(new Error("!this.rootNode"));return;}if(path[0]!==this.rootNode.item&&(dojo.isString(path[0])&&path[0]!=this.model.getIdentity(this.rootNode.item))){d.reject(new Error(this.id+":path[0] doesn't match this.rootNode.item.  Maybe you are using the wrong tree."));return;}path.shift();var node=this.rootNode;function _17c(){var item=path.shift(),_17d=dojo.isString(item)?item:this.model.getIdentity(item);dojo.some(this._itemNodesMap[_17d],function(n){if(n.getParent()==node){node=n;return true;}return false;});if(path.length){this._expandNode(node).addCallback(dojo.hitch(this,_17c));}else{this._selectNode(node);d.resolve(true);}};this._expandNode(node).addCallback(dojo.hitch(this,_17c));}));return d;},_getPathAttr:function(){if(!this.selectedNode){return;}var res=[];var _17e=this.selectedNode;while(_17e&&_17e!==this.rootNode){res.unshift(_17e.item);_17e=_17e.getParent();}res.unshift(this.rootNode.item);return res;},mayHaveChildren:function(item){},getItemChildren:function(_17f,_180){},getLabel:function(item){return this.model.getLabel(item);},getIconClass:function(item,_181){return (!item||this.model.mayHaveChildren(item))?(_181?"dijitFolderOpened":"dijitFolderClosed"):"dijitLeaf";},getLabelClass:function(item,_182){},getRowClass:function(item,_183){},getIconStyle:function(item,_184){},getLabelStyle:function(item,_185){},getRowStyle:function(item,_186){},getTooltip:function(item){return "";},_onKeyPress:function(e){if(e.altKey){return;}var dk=dojo.keys;var _187=dijit.getEnclosingWidget(e.target);if(!_187){return;}var key=e.charOrCode;if(typeof key=="string"){if(!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey){this._onLetterKeyNav({node:_187,key:key.toLowerCase()});dojo.stopEvent(e);}}else{if(this._curSearch){clearTimeout(this._curSearch.timer);delete this._curSearch;}var map=this._keyHandlerMap;if(!map){map={};map[dk.ENTER]="_onEnterKey";map[this.isLeftToRight()?dk.LEFT_ARROW:dk.RIGHT_ARROW]="_onLeftArrow";map[this.isLeftToRight()?dk.RIGHT_ARROW:dk.LEFT_ARROW]="_onRightArrow";map[dk.UP_ARROW]="_onUpArrow";map[dk.DOWN_ARROW]="_onDownArrow";map[dk.HOME]="_onHomeKey";map[dk.END]="_onEndKey";this._keyHandlerMap=map;}if(this._keyHandlerMap[key]){this[this._keyHandlerMap[key]]({node:_187,item:_187.item,evt:e});dojo.stopEvent(e);}}},_onEnterKey:function(_188,evt){this._publish("execute",{item:_188.item,node:_188.node});this._selectNode(_188.node);this.onClick(_188.item,_188.node,evt);},_onDownArrow:function(_189){var node=this._getNextNode(_189.node);if(node&&node.isTreeNode){this.focusNode(node);}},_onUpArrow:function(_18a){var node=_18a.node;var _18b=node.getPreviousSibling();if(_18b){node=_18b;while(node.isExpandable&&node.isExpanded&&node.hasChildren()){var _18c=node.getChildren();node=_18c[_18c.length-1];}}else{var _18d=node.getParent();if(!(!this.showRoot&&_18d===this.rootNode)){node=_18d;}}if(node&&node.isTreeNode){this.focusNode(node);}},_onRightArrow:function(_18e){var node=_18e.node;if(node.isExpandable&&!node.isExpanded){this._expandNode(node);}else{if(node.hasChildren()){node=node.getChildren()[0];if(node&&node.isTreeNode){this.focusNode(node);}}}},_onLeftArrow:function(_18f){var node=_18f.node;if(node.isExpandable&&node.isExpanded){this._collapseNode(node);}else{var _190=node.getParent();if(_190&&_190.isTreeNode&&!(!this.showRoot&&_190===this.rootNode)){this.focusNode(_190);}}},_onHomeKey:function(){var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}},_onEndKey:function(_191){var node=this.rootNode;while(node.isExpanded){var c=node.getChildren();node=c[c.length-1];}if(node&&node.isTreeNode){this.focusNode(node);}},multiCharSearchDuration:250,_onLetterKeyNav:function(_192){var cs=this._curSearch;if(cs){cs.pattern=cs.pattern+_192.key;clearTimeout(cs.timer);}else{cs=this._curSearch={pattern:_192.key,startNode:_192.node};}var self=this;cs.timer=setTimeout(function(){delete self._curSearch;},this.multiCharSearchDuration);var node=cs.startNode;do{node=this._getNextNode(node);if(!node){node=this._getRootOrFirstNode();}}while(node!==cs.startNode&&(node.label.toLowerCase().substr(0,cs.pattern.length)!=cs.pattern));if(node&&node.isTreeNode){if(node!==cs.startNode){this.focusNode(node);}}},_onClick:function(_193,e){var _194=e.target,_195=(_194==_193.expandoNode||_194==_193.expandoNodeText);if((this.openOnClick&&_193.isExpandable)||_195){if(_193.isExpandable){this._onExpandoClick({node:_193});}}else{this._publish("execute",{item:_193.item,node:_193,evt:e});this.onClick(_193.item,_193,e);this.focusNode(_193);}if(!_195){this._selectNode(_193);}dojo.stopEvent(e);},_onDblClick:function(_196,e){var _197=e.target,_198=(_197==_196.expandoNode||_197==_196.expandoNodeText);if((this.openOnDblClick&&_196.isExpandable)||_198){if(_196.isExpandable){this._onExpandoClick({node:_196});}}else{this._publish("execute",{item:_196.item,node:_196,evt:e});this.onDblClick(_196.item,_196,e);this.focusNode(_196);}if(!_198){this._selectNode(_196);}dojo.stopEvent(e);},_onExpandoClick:function(_199){var node=_199.node;this.focusNode(node);if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}},onClick:function(item,node,evt){},onDblClick:function(item,node,evt){},onOpen:function(item,node){},onClose:function(item,node){},_getNextNode:function(node){if(node.isExpandable&&node.isExpanded&&node.hasChildren()){return node.getChildren()[0];}else{while(node&&node.isTreeNode){var _19a=node.getNextSibling();if(_19a){return _19a;}node=node.getParent();}return null;}},_getRootOrFirstNode:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0];},_collapseNode:function(node){if(node._expandNodeDeferred){delete node._expandNodeDeferred;}if(node.isExpandable){if(node.state=="LOADING"){return;}node.collapse();this.onClose(node.item,node);if(node.item){this._state(node.item,false);this._saveState();}}},_expandNode:function(node,_19b){if(node._expandNodeDeferred&&!_19b){return node._expandNodeDeferred;}var _19c=this.model,item=node.item,_19d=this;switch(node.state){case "UNCHECKED":node.markProcessing();var def=(node._expandNodeDeferred=new dojo.Deferred());_19c.getChildren(item,function(_19e){node.unmarkProcessing();var scid=node.setChildItems(_19e);var ed=_19d._expandNode(node,true);scid.addCallback(function(){ed.addCallback(function(){def.callback();});});},function(err){console.error(_19d,": error loading root children: ",err);});break;default:def=(node._expandNodeDeferred=node.expand());this.onOpen(node.item,node);if(item){this._state(item,true);this._saveState();}}return def;},focusNode:function(node){dijit.focus(node.labelNode);},_selectNode:function(node){if(this.selectedNode&&!this.selectedNode._destroyed){this.selectedNode.setSelected(false);}if(node){node.setSelected(true);}this.selectedNode=node;},_onNodeFocus:function(node){if(node&&node!=this.lastFocused){if(this.lastFocused&&!this.lastFocused._destroyed){this.lastFocused.setFocusable(false);}node.setFocusable(true);this.lastFocused=node;}},_onNodeMouseEnter:function(node){},_onNodeMouseLeave:function(node){},_onItemChange:function(item){var _19f=this.model,_1a0=_19f.getIdentity(item),_1a1=this._itemNodesMap[_1a0];if(_1a1){var _1a2=this.getLabel(item),_1a3=this.getTooltip(item);dojo.forEach(_1a1,function(node){node.set({item:item,label:_1a2,tooltip:_1a3});node._updateItemClasses(item);});}},_onItemChildrenChange:function(_1a4,_1a5){var _1a6=this.model,_1a7=_1a6.getIdentity(_1a4),_1a8=this._itemNodesMap[_1a7];if(_1a8){dojo.forEach(_1a8,function(_1a9){_1a9.setChildItems(_1a5);});}},_onItemDelete:function(item){var _1aa=this.model,_1ab=_1aa.getIdentity(item),_1ac=this._itemNodesMap[_1ab];if(_1ac){dojo.forEach(_1ac,function(node){var _1ad=node.getParent();if(_1ad){_1ad.removeChild(node);}node.destroyRecursive();});delete this._itemNodesMap[_1ab];}},_initState:function(){if(this.persist){var _1ae=dojo.cookie(this.cookieName);this._openedItemIds={};if(_1ae){dojo.forEach(_1ae.split(","),function(item){this._openedItemIds[item]=true;},this);}}},_state:function(item,_1af){if(!this.persist){return false;}var id=this.model.getIdentity(item);if(arguments.length===1){return this._openedItemIds[id];}if(_1af){this._openedItemIds[id]=true;}else{delete this._openedItemIds[id];}},_saveState:function(){if(!this.persist){return;}var ary=[];for(var id in this._openedItemIds){ary.push(id);}dojo.cookie(this.cookieName,ary.join(","),{expires:365});},destroy:function(){if(this._curSearch){clearTimeout(this._curSearch.timer);delete this._curSearch;}if(this.rootNode){this.rootNode.destroyRecursive();}if(this.dndController&&!dojo.isString(this.dndController)){this.dndController.destroy();}this.rootNode=null;this.inherited(arguments);},destroyRecursive:function(){this.destroy();},resize:function(_1b0){if(_1b0){dojo.marginBox(this.domNode,_1b0);dojo.style(this.domNode,"overflow","auto");}this._nodePixelIndent=dojo.marginBox(this.tree.indentDetector).w;if(this.tree.rootNode){this.tree.rootNode.set("indent",this.showRoot?0:-1);}},_createTreeNode:function(args){return new dijit._TreeNode(args);}});}if(!dojo._hasResource["dojo.data.ItemFileWriteStore"]){dojo._hasResource["dojo.data.ItemFileWriteStore"]=true;dojo.provide("dojo.data.ItemFileWriteStore");dojo.declare("dojo.data.ItemFileWriteStore",dojo.data.ItemFileReadStore,{constructor:function(_1b1){this._features["dojo.data.api.Write"]=true;this._features["dojo.data.api.Notification"]=true;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};if(!this._datatypeMap["Date"].serialize){this._datatypeMap["Date"].serialize=function(obj){return dojo.date.stamp.toISOString(obj,{zulu:true});};}if(_1b1&&(_1b1.referenceIntegrity===false)){this.referenceIntegrity=false;}this._saveInProgress=false;},referenceIntegrity:true,_assert:function(_1b2){if(!_1b2){throw new Error("assertion failed in ItemFileWriteStore");}},_getIdentifierAttribute:function(){var _1b3=this.getFeatures()["dojo.data.api.Identity"];return _1b3;},newItem:function(_1b4,_1b5){this._assert(!this._saveInProgress);if(!this._loadFinished){this._forceLoad();}if(typeof _1b4!="object"&&typeof _1b4!="undefined"){throw new Error("newItem() was passed something other than an object");}var _1b6=null;var _1b7=this._getIdentifierAttribute();if(_1b7===Number){_1b6=this._arrayOfAllItems.length;}else{_1b6=_1b4[_1b7];if(typeof _1b6==="undefined"){throw new Error("newItem() was not passed an identity for the new item");}if(dojo.isArray(_1b6)){throw new Error("newItem() was not passed an single-valued identity");}}if(this._itemsByIdentity){this._assert(typeof this._itemsByIdentity[_1b6]==="undefined");}this._assert(typeof this._pending._newItems[_1b6]==="undefined");this._assert(typeof this._pending._deletedItems[_1b6]==="undefined");var _1b8={};_1b8[this._storeRefPropName]=this;_1b8[this._itemNumPropName]=this._arrayOfAllItems.length;if(this._itemsByIdentity){this._itemsByIdentity[_1b6]=_1b8;_1b8[_1b7]=[_1b6];}this._arrayOfAllItems.push(_1b8);var _1b9=null;if(_1b5&&_1b5.parent&&_1b5.attribute){_1b9={item:_1b5.parent,attribute:_1b5.attribute,oldValue:undefined};var _1ba=this.getValues(_1b5.parent,_1b5.attribute);if(_1ba&&_1ba.length>0){var _1bb=_1ba.slice(0,_1ba.length);if(_1ba.length===1){_1b9.oldValue=_1ba[0];}else{_1b9.oldValue=_1ba.slice(0,_1ba.length);}_1bb.push(_1b8);this._setValueOrValues(_1b5.parent,_1b5.attribute,_1bb,false);_1b9.newValue=this.getValues(_1b5.parent,_1b5.attribute);}else{this._setValueOrValues(_1b5.parent,_1b5.attribute,_1b8,false);_1b9.newValue=_1b8;}}else{_1b8[this._rootItemPropName]=true;this._arrayOfTopLevelItems.push(_1b8);}this._pending._newItems[_1b6]=_1b8;for(var key in _1b4){if(key===this._storeRefPropName||key===this._itemNumPropName){throw new Error("encountered bug in ItemFileWriteStore.newItem");}var _1bc=_1b4[key];if(!dojo.isArray(_1bc)){_1bc=[_1bc];}_1b8[key]=_1bc;if(this.referenceIntegrity){for(var i=0;i<_1bc.length;i++){var val=_1bc[i];if(this.isItem(val)){this._addReferenceToMap(val,_1b8,key);}}}}this.onNew(_1b8,_1b9);return _1b8;},_removeArrayElement:function(_1bd,_1be){var _1bf=dojo.indexOf(_1bd,_1be);if(_1bf!=-1){_1bd.splice(_1bf,1);return true;}return false;},deleteItem:function(item){this._assert(!this._saveInProgress);this._assertIsItem(item);var _1c0=item[this._itemNumPropName];var _1c1=this.getIdentity(item);if(this.referenceIntegrity){var _1c2=this.getAttributes(item);if(item[this._reverseRefMap]){item["backup_"+this._reverseRefMap]=dojo.clone(item[this._reverseRefMap]);}dojo.forEach(_1c2,function(_1c3){dojo.forEach(this.getValues(item,_1c3),function(_1c4){if(this.isItem(_1c4)){if(!item["backupRefs_"+this._reverseRefMap]){item["backupRefs_"+this._reverseRefMap]=[];}item["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(_1c4),attr:_1c3});this._removeReferenceFromMap(_1c4,item,_1c3);}},this);},this);var _1c5=item[this._reverseRefMap];if(_1c5){for(var _1c6 in _1c5){var _1c7=null;if(this._itemsByIdentity){_1c7=this._itemsByIdentity[_1c6];}else{_1c7=this._arrayOfAllItems[_1c6];}if(_1c7){for(var _1c8 in _1c5[_1c6]){var _1c9=this.getValues(_1c7,_1c8)||[];var _1ca=dojo.filter(_1c9,function(_1cb){return !(this.isItem(_1cb)&&this.getIdentity(_1cb)==_1c1);},this);this._removeReferenceFromMap(item,_1c7,_1c8);if(_1ca.length<_1c9.length){this._setValueOrValues(_1c7,_1c8,_1ca,true);}}}}}}this._arrayOfAllItems[_1c0]=null;item[this._storeRefPropName]=null;if(this._itemsByIdentity){delete this._itemsByIdentity[_1c1];}this._pending._deletedItems[_1c1]=item;if(item[this._rootItemPropName]){this._removeArrayElement(this._arrayOfTopLevelItems,item);}this.onDelete(item);return true;},setValue:function(item,_1cc,_1cd){return this._setValueOrValues(item,_1cc,_1cd,true);},setValues:function(item,_1ce,_1cf){return this._setValueOrValues(item,_1ce,_1cf,true);},unsetAttribute:function(item,_1d0){return this._setValueOrValues(item,_1d0,[],true);},_setValueOrValues:function(item,_1d1,_1d2,_1d3){this._assert(!this._saveInProgress);this._assertIsItem(item);this._assert(dojo.isString(_1d1));this._assert(typeof _1d2!=="undefined");var _1d4=this._getIdentifierAttribute();if(_1d1==_1d4){throw new Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");}var _1d5=this._getValueOrValues(item,_1d1);var _1d6=this.getIdentity(item);if(!this._pending._modifiedItems[_1d6]){var _1d7={};for(var key in item){if((key===this._storeRefPropName)||(key===this._itemNumPropName)||(key===this._rootItemPropName)){_1d7[key]=item[key];}else{if(key===this._reverseRefMap){_1d7[key]=dojo.clone(item[key]);}else{_1d7[key]=item[key].slice(0,item[key].length);}}}this._pending._modifiedItems[_1d6]=_1d7;}var _1d8=false;if(dojo.isArray(_1d2)&&_1d2.length===0){_1d8=delete item[_1d1];_1d2=undefined;if(this.referenceIntegrity&&_1d5){var _1d9=_1d5;if(!dojo.isArray(_1d9)){_1d9=[_1d9];}for(var i=0;i<_1d9.length;i++){var _1da=_1d9[i];if(this.isItem(_1da)){this._removeReferenceFromMap(_1da,item,_1d1);}}}}else{var _1db;if(dojo.isArray(_1d2)){var _1dc=_1d2;_1db=_1d2.slice(0,_1d2.length);}else{_1db=[_1d2];}if(this.referenceIntegrity){if(_1d5){var _1d9=_1d5;if(!dojo.isArray(_1d9)){_1d9=[_1d9];}var map={};dojo.forEach(_1d9,function(_1dd){if(this.isItem(_1dd)){var id=this.getIdentity(_1dd);map[id.toString()]=true;}},this);dojo.forEach(_1db,function(_1de){if(this.isItem(_1de)){var id=this.getIdentity(_1de);if(map[id.toString()]){delete map[id.toString()];}else{this._addReferenceToMap(_1de,item,_1d1);}}},this);for(var rId in map){var _1df;if(this._itemsByIdentity){_1df=this._itemsByIdentity[rId];}else{_1df=this._arrayOfAllItems[rId];}this._removeReferenceFromMap(_1df,item,_1d1);}}else{for(var i=0;i<_1db.length;i++){var _1da=_1db[i];if(this.isItem(_1da)){this._addReferenceToMap(_1da,item,_1d1);}}}}item[_1d1]=_1db;_1d8=true;}if(_1d3){this.onSet(item,_1d1,_1d5,_1d2);}return _1d8;},_addReferenceToMap:function(_1e0,_1e1,_1e2){var _1e3=this.getIdentity(_1e1);var _1e4=_1e0[this._reverseRefMap];if(!_1e4){_1e4=_1e0[this._reverseRefMap]={};}var _1e5=_1e4[_1e3];if(!_1e5){_1e5=_1e4[_1e3]={};}_1e5[_1e2]=true;},_removeReferenceFromMap:function(_1e6,_1e7,_1e8){var _1e9=this.getIdentity(_1e7);var _1ea=_1e6[this._reverseRefMap];var _1eb;if(_1ea){for(_1eb in _1ea){if(_1eb==_1e9){delete _1ea[_1eb][_1e8];if(this._isEmpty(_1ea[_1eb])){delete _1ea[_1eb];}}}if(this._isEmpty(_1ea)){delete _1e6[this._reverseRefMap];}}},_dumpReferenceMap:function(){var i;for(i=0;i<this._arrayOfAllItems.length;i++){var item=this._arrayOfAllItems[i];if(item&&item[this._reverseRefMap]){console.log("Item: ["+this.getIdentity(item)+"] is referenced by: "+dojo.toJson(item[this._reverseRefMap]));}}},_getValueOrValues:function(item,_1ec){var _1ed=undefined;if(this.hasAttribute(item,_1ec)){var _1ee=this.getValues(item,_1ec);if(_1ee.length==1){_1ed=_1ee[0];}else{_1ed=_1ee;}}return _1ed;},_flatten:function(_1ef){if(this.isItem(_1ef)){var item=_1ef;var _1f0=this.getIdentity(item);var _1f1={_reference:_1f0};return _1f1;}else{if(typeof _1ef==="object"){for(var type in this._datatypeMap){var _1f2=this._datatypeMap[type];if(dojo.isObject(_1f2)&&!dojo.isFunction(_1f2)){if(_1ef instanceof _1f2.type){if(!_1f2.serialize){throw new Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+type+"]");}return {_type:type,_value:_1f2.serialize(_1ef)};}}else{if(_1ef instanceof _1f2){return {_type:type,_value:_1ef.toString()};}}}}return _1ef;}},_getNewFileContentString:function(){var _1f3={};var _1f4=this._getIdentifierAttribute();if(_1f4!==Number){_1f3.identifier=_1f4;}if(this._labelAttr){_1f3.label=this._labelAttr;}_1f3.items=[];for(var i=0;i<this._arrayOfAllItems.length;++i){var item=this._arrayOfAllItems[i];if(item!==null){var _1f5={};for(var key in item){if(key!==this._storeRefPropName&&key!==this._itemNumPropName&&key!==this._reverseRefMap&&key!==this._rootItemPropName){var _1f6=key;var _1f7=this.getValues(item,_1f6);if(_1f7.length==1){_1f5[_1f6]=this._flatten(_1f7[0]);}else{var _1f8=[];for(var j=0;j<_1f7.length;++j){_1f8.push(this._flatten(_1f7[j]));_1f5[_1f6]=_1f8;}}}}_1f3.items.push(_1f5);}}var _1f9=true;return dojo.toJson(_1f3,_1f9);},_isEmpty:function(_1fa){var _1fb=true;if(dojo.isObject(_1fa)){var i;for(i in _1fa){_1fb=false;break;}}else{if(dojo.isArray(_1fa)){if(_1fa.length>0){_1fb=false;}}}return _1fb;},save:function(_1fc){this._assert(!this._saveInProgress);this._saveInProgress=true;var self=this;var _1fd=function(){self._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};self._saveInProgress=false;if(_1fc&&_1fc.onComplete){var _1fe=_1fc.scope||dojo.global;_1fc.onComplete.call(_1fe);}};var _1ff=function(err){self._saveInProgress=false;if(_1fc&&_1fc.onError){var _200=_1fc.scope||dojo.global;_1fc.onError.call(_200,err);}};if(this._saveEverything){var _201=this._getNewFileContentString();this._saveEverything(_1fd,_1ff,_201);}if(this._saveCustom){this._saveCustom(_1fd,_1ff);}if(!this._saveEverything&&!this._saveCustom){_1fd();}},revert:function(){this._assert(!this._saveInProgress);var _202;for(_202 in this._pending._modifiedItems){var _203=this._pending._modifiedItems[_202];var _204=null;if(this._itemsByIdentity){_204=this._itemsByIdentity[_202];}else{_204=this._arrayOfAllItems[_202];}_203[this._storeRefPropName]=this;for(key in _204){delete _204[key];}dojo.mixin(_204,_203);}var _205;for(_202 in this._pending._deletedItems){_205=this._pending._deletedItems[_202];_205[this._storeRefPropName]=this;var _206=_205[this._itemNumPropName];if(_205["backup_"+this._reverseRefMap]){_205[this._reverseRefMap]=_205["backup_"+this._reverseRefMap];delete _205["backup_"+this._reverseRefMap];}this._arrayOfAllItems[_206]=_205;if(this._itemsByIdentity){this._itemsByIdentity[_202]=_205;}if(_205[this._rootItemPropName]){this._arrayOfTopLevelItems.push(_205);}}for(_202 in this._pending._deletedItems){_205=this._pending._deletedItems[_202];if(_205["backupRefs_"+this._reverseRefMap]){dojo.forEach(_205["backupRefs_"+this._reverseRefMap],function(_207){var _208;if(this._itemsByIdentity){_208=this._itemsByIdentity[_207.id];}else{_208=this._arrayOfAllItems[_207.id];}this._addReferenceToMap(_208,_205,_207.attr);},this);delete _205["backupRefs_"+this._reverseRefMap];}}for(_202 in this._pending._newItems){var _209=this._pending._newItems[_202];_209[this._storeRefPropName]=null;this._arrayOfAllItems[_209[this._itemNumPropName]]=null;if(_209[this._rootItemPropName]){this._removeArrayElement(this._arrayOfTopLevelItems,_209);}if(this._itemsByIdentity){delete this._itemsByIdentity[_202];}}this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return true;},isDirty:function(item){if(item){var _20a=this.getIdentity(item);return new Boolean(this._pending._newItems[_20a]||this._pending._modifiedItems[_20a]||this._pending._deletedItems[_20a]).valueOf();}else{if(!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)){return true;}return false;}},onSet:function(item,_20b,_20c,_20d){},onNew:function(_20e,_20f){},onDelete:function(_210){},close:function(_211){if(this.clearOnClose){if(!this.isDirty()){this.inherited(arguments);}else{throw new Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");}}}});}if(!dojo._hasResource["dojo.dnd.move"]){dojo._hasResource["dojo.dnd.move"]=true;dojo.provide("dojo.dnd.move");dojo.declare("dojo.dnd.move.constrainedMoveable",dojo.dnd.Moveable,{constraints:function(){},within:false,markupFactory:function(_212,node){return new dojo.dnd.move.constrainedMoveable(node,_212);},constructor:function(node,_213){if(!_213){_213={};}this.constraints=_213.constraints;this.within=_213.within;},onFirstMove:function(_214){var c=this.constraintBox=this.constraints.call(this,_214);c.r=c.l+c.w;c.b=c.t+c.h;if(this.within){var mb=dojo.marginBox(_214.node);c.r-=mb.w;c.b-=mb.h;}},onMove:function(_215,_216){var c=this.constraintBox,s=_215.node.style;s.left=(_216.l<c.l?c.l:c.r<_216.l?c.r:_216.l)+"px";s.top=(_216.t<c.t?c.t:c.b<_216.t?c.b:_216.t)+"px";}});dojo.declare("dojo.dnd.move.boxConstrainedMoveable",dojo.dnd.move.constrainedMoveable,{box:{},markupFactory:function(_217,node){return new dojo.dnd.move.boxConstrainedMoveable(node,_217);},constructor:function(node,_218){var box=_218&&_218.box;this.constraints=function(){return box;};}});dojo.declare("dojo.dnd.move.parentConstrainedMoveable",dojo.dnd.move.constrainedMoveable,{area:"content",markupFactory:function(_219,node){return new dojo.dnd.move.parentConstrainedMoveable(node,_219);},constructor:function(node,_21a){var area=_21a&&_21a.area;this.constraints=function(){var n=this.node.parentNode,s=dojo.getComputedStyle(n),mb=dojo._getMarginBox(n,s);if(area=="margin"){return mb;}var t=dojo._getMarginExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(area=="border"){return mb;}t=dojo._getBorderExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(area=="padding"){return mb;}t=dojo._getPadExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;return mb;};}});dojo.dnd.move.constrainedMover=function(fun,_21b){dojo.deprecated("dojo.dnd.move.constrainedMover, use dojo.dnd.move.constrainedMoveable instead");var _21c=function(node,e,_21d){dojo.dnd.Mover.call(this,node,e,_21d);};dojo.extend(_21c,dojo.dnd.Mover.prototype);dojo.extend(_21c,{onMouseMove:function(e){dojo.dnd.autoScroll(e);var m=this.marginBox,c=this.constraintBox,l=m.l+e.pageX,t=m.t+e.pageY;l=l<c.l?c.l:c.r<l?c.r:l;t=t<c.t?c.t:c.b<t?c.b:t;this.host.onMove(this,{l:l,t:t});},onFirstMove:function(){dojo.dnd.Mover.prototype.onFirstMove.call(this);var c=this.constraintBox=fun.call(this);c.r=c.l+c.w;c.b=c.t+c.h;if(_21b){var mb=dojo.marginBox(this.node);c.r-=mb.w;c.b-=mb.h;}}});return _21c;};dojo.dnd.move.boxConstrainedMover=function(box,_21e){dojo.deprecated("dojo.dnd.move.boxConstrainedMover, use dojo.dnd.move.boxConstrainedMoveable instead");return dojo.dnd.move.constrainedMover(function(){return box;},_21e);};dojo.dnd.move.parentConstrainedMover=function(area,_21f){dojo.deprecated("dojo.dnd.move.parentConstrainedMover, use dojo.dnd.move.parentConstrainedMoveable instead");var fun=function(){var n=this.node.parentNode,s=dojo.getComputedStyle(n),mb=dojo._getMarginBox(n,s);if(area=="margin"){return mb;}var t=dojo._getMarginExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(area=="border"){return mb;}t=dojo._getBorderExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(area=="padding"){return mb;}t=dojo._getPadExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;return mb;};return dojo.dnd.move.constrainedMover(fun,_21f);};dojo.dnd.constrainedMover=dojo.dnd.move.constrainedMover;dojo.dnd.boxConstrainedMover=dojo.dnd.move.boxConstrainedMover;dojo.dnd.parentConstrainedMover=dojo.dnd.move.parentConstrainedMover;}if(!dojo._hasResource["dojo.dnd.TimedMoveable"]){dojo._hasResource["dojo.dnd.TimedMoveable"]=true;dojo.provide("dojo.dnd.TimedMoveable");(function(){var _220=dojo.dnd.Moveable.prototype.onMove;dojo.declare("dojo.dnd.TimedMoveable",dojo.dnd.Moveable,{timeout:40,constructor:function(node,_221){if(!_221){_221={};}if(_221.timeout&&typeof _221.timeout=="number"&&_221.timeout>=0){this.timeout=_221.timeout;}},markupFactory:function(_222,node){return new dojo.dnd.TimedMoveable(node,_222);},onMoveStop:function(_223){if(_223._timer){clearTimeout(_223._timer);_220.call(this,_223,_223._leftTop);}dojo.dnd.Moveable.prototype.onMoveStop.apply(this,arguments);},onMove:function(_224,_225){_224._leftTop=_225;if(!_224._timer){var _226=this;_224._timer=setTimeout(function(){_224._timer=null;_220.call(_226,_224,_224._leftTop);},this.timeout);}}});})();}if(!dojo._hasResource["dijit.form._FormMixin"]){dojo._hasResource["dijit.form._FormMixin"]=true;dojo.provide("dijit.form._FormMixin");dojo.declare("dijit.form._FormMixin",null,{reset:function(){dojo.forEach(this.getDescendants(),function(_227){if(_227.reset){_227.reset();}});},validate:function(){var _228=false;return dojo.every(dojo.map(this.getDescendants(),function(_229){_229._hasBeenBlurred=true;var _22a=_229.disabled||!_229.validate||_229.validate();if(!_22a&&!_228){dojo.window.scrollIntoView(_229.containerNode||_229.domNode);_229.focus();_228=true;}return _22a;}),function(item){return item;});},setValues:function(val){dojo.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",val);},_setValueAttr:function(obj){var map={};dojo.forEach(this.getDescendants(),function(_22b){if(!_22b.name){return;}var _22c=map[_22b.name]||(map[_22b.name]=[]);_22c.push(_22b);});for(var name in map){if(!map.hasOwnProperty(name)){continue;}var _22d=map[name],_22e=dojo.getObject(name,false,obj);if(_22e===undefined){continue;}if(!dojo.isArray(_22e)){_22e=[_22e];}if(typeof _22d[0].checked=="boolean"){dojo.forEach(_22d,function(w,i){w.set("value",dojo.indexOf(_22e,w.value)!=-1);});}else{if(_22d[0].multiple){_22d[0].set("value",_22e);}else{dojo.forEach(_22d,function(w,i){w.set("value",_22e[i]);});}}}},getValues:function(){dojo.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value");},_getValueAttr:function(){var obj={};dojo.forEach(this.getDescendants(),function(_22f){var name=_22f.name;if(!name||_22f.disabled){return;}var _230=_22f.get("value");if(typeof _22f.checked=="boolean"){if(/Radio/.test(_22f.declaredClass)){if(_230!==false){dojo.setObject(name,_230,obj);}else{_230=dojo.getObject(name,false,obj);if(_230===undefined){dojo.setObject(name,null,obj);}}}else{var ary=dojo.getObject(name,false,obj);if(!ary){ary=[];dojo.setObject(name,ary,obj);}if(_230!==false){ary.push(_230);}}}else{var prev=dojo.getObject(name,false,obj);if(typeof prev!="undefined"){if(dojo.isArray(prev)){prev.push(_230);}else{dojo.setObject(name,[prev,_230],obj);}}else{dojo.setObject(name,_230,obj);}}});return obj;},isValid:function(){this._invalidWidgets=dojo.filter(this.getDescendants(),function(_231){return !_231.disabled&&_231.isValid&&!_231.isValid();});return !this._invalidWidgets.length;},onValidStateChange:function(_232){},_widgetChange:function(_233){var _234=this._lastValidState;if(!_233||this._lastValidState===undefined){_234=this.isValid();if(this._lastValidState===undefined){this._lastValidState=_234;}}else{if(_233.isValid){this._invalidWidgets=dojo.filter(this._invalidWidgets||[],function(w){return (w!=_233);},this);if(!_233.isValid()&&!_233.get("disabled")){this._invalidWidgets.push(_233);}_234=(this._invalidWidgets.length===0);}}if(_234!==this._lastValidState){this._lastValidState=_234;this.onValidStateChange(_234);}},connectChildren:function(){dojo.forEach(this._changeConnections,dojo.hitch(this,"disconnect"));var _235=this;var _236=(this._changeConnections=[]);dojo.forEach(dojo.filter(this.getDescendants(),function(item){return item.validate;}),function(_237){_236.push(_235.connect(_237,"validate",dojo.hitch(_235,"_widgetChange",_237)));_236.push(_235.connect(_237,"_setDisabledAttr",dojo.hitch(_235,"_widgetChange",_237)));});this._widgetChange(null);},startup:function(){this.inherited(arguments);this._changeConnections=[];this.connectChildren();}});}if(!dojo._hasResource["dijit._DialogMixin"]){dojo._hasResource["dijit._DialogMixin"]=true;dojo.provide("dijit._DialogMixin");dojo.declare("dijit._DialogMixin",null,{attributeMap:dijit._Widget.prototype.attributeMap,execute:function(_238){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"));},_getFocusItems:function(_239){var _23a=dijit._getTabNavigable(dojo.byId(_239));this._firstFocusItem=_23a.lowest||_23a.first||_239;this._lastFocusItem=_23a.last||_23a.highest||this._firstFocusItem;if(dojo.isMoz&&this._firstFocusItem.tagName.toLowerCase()=="input"&&dojo.getNodeProp(this._firstFocusItem,"type").toLowerCase()=="file"){dojo.attr(_239,"tabIndex","0");this._firstFocusItem=_239;}}});}if(!dojo._hasResource["dijit.DialogUnderlay"]){dojo._hasResource["dijit.DialogUnderlay"]=true;dojo.provide("dijit.DialogUnderlay");dojo.declare("dijit.DialogUnderlay",[dijit._Widget,dijit._Templated],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' dojoAttachPoint='node'></div></div>",dialogId:"","class":"",attributeMap:{id:"domNode"},_setDialogIdAttr:function(id){dojo.attr(this.node,"id",id+"_underlay");},_setClassAttr:function(_23b){this.node.className="dijitDialogUnderlay "+_23b;},postCreate:function(){dojo.body().appendChild(this.domNode);},layout:function(){var is=this.node.style,os=this.domNode.style;os.display="none";var _23c=dojo.window.getBox();os.top=_23c.t+"px";os.left=_23c.l+"px";is.width=_23c.w+"px";is.height=_23c.h+"px";os.display="block";},show:function(){this.domNode.style.display="block";this.layout();this.bgIframe=new dijit.BackgroundIframe(this.domNode);},hide:function(){this.bgIframe.destroy();this.domNode.style.display="none";},uninitialize:function(){if(this.bgIframe){this.bgIframe.destroy();}this.inherited(arguments);}});}if(!dojo._hasResource["dijit.TooltipDialog"]){dojo._hasResource["dijit.TooltipDialog"]=true;dojo.provide("dijit.TooltipDialog");dojo.declare("dijit.TooltipDialog",[dijit.layout.ContentPane,dijit._Templated,dijit.form._FormMixin,dijit._DialogMixin],{title:"",doLayout:false,autofocus:true,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,templateString:dojo.cache("dijit","templates/TooltipDialog.html","<div waiRole=\"presentation\">\n\t<div class=\"dijitTooltipContainer\" waiRole=\"presentation\">\n\t\t<div class =\"dijitTooltipContents dijitTooltipFocusNode\" dojoAttachPoint=\"containerNode\" tabindex=\"-1\" waiRole=\"dialog\"></div>\n\t</div>\n\t<div class=\"dijitTooltipConnector\" waiRole=\"presentation\"></div>\n</div>\n"),postCreate:function(){this.inherited(arguments);this.connect(this.containerNode,"onkeypress","_onKey");this.containerNode.title=this.title;},orient:function(node,_23d,_23e){var c=this._currentOrientClass;if(c){dojo.removeClass(this.domNode,c);}c="dijitTooltipAB"+(_23e.charAt(1)=="L"?"Left":"Right")+" dijitTooltip"+(_23e.charAt(0)=="T"?"Below":"Above");dojo.addClass(this.domNode,c);this._currentOrientClass=c;},onOpen:function(pos){this.orient(this.domNode,pos.aroundCorner,pos.corner);this._onShow();if(this.autofocus){this._getFocusItems(this.containerNode);dijit.focus(this._firstFocusItem);}},onClose:function(){this.onHide();},_onKey:function(evt){var node=evt.target;var dk=dojo.keys;if(evt.charOrCode===dk.TAB){this._getFocusItems(this.containerNode);}var _23f=(this._firstFocusItem==this._lastFocusItem);if(evt.charOrCode==dk.ESCAPE){setTimeout(dojo.hitch(this,"onCancel"),0);dojo.stopEvent(evt);}else{if(node==this._firstFocusItem&&evt.shiftKey&&evt.charOrCode===dk.TAB){if(!_23f){dijit.focus(this._lastFocusItem);}dojo.stopEvent(evt);}else{if(node==this._lastFocusItem&&evt.charOrCode===dk.TAB&&!evt.shiftKey){if(!_23f){dijit.focus(this._firstFocusItem);}dojo.stopEvent(evt);}else{if(evt.charOrCode===dk.TAB){evt.stopPropagation();}}}}}});}if(!dojo._hasResource["dijit.Dialog"]){dojo._hasResource["dijit.Dialog"]=true;dojo.provide("dijit.Dialog");dojo.declare("dijit._DialogBase",[dijit._Templated,dijit.form._FormMixin,dijit._DialogMixin,dijit._CssStateMixin],{templateString:dojo.cache("dijit","templates/Dialog.html","<div class=\"dijitDialog\" tabindex=\"-1\" waiRole=\"dialog\" waiState=\"labelledby-${id}_title\">\n\t<div dojoAttachPoint=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t<span dojoAttachPoint=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n\t<span dojoAttachPoint=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" dojoAttachEvent=\"onclick: onCancel\" title=\"${buttonCancel}\">\n\t\t<span dojoAttachPoint=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t</span>\n\t</div>\n\t\t<div dojoAttachPoint=\"containerNode\" class=\"dijitDialogPaneContent\"></div>\n</div>\n"),baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{title:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],"aria-describedby":""}),open:false,duration:dijit.defaultDuration,refocus:true,autofocus:true,_firstFocusItem:null,_lastFocusItem:null,doLayout:false,draggable:true,"aria-describedby":"",postMixInProperties:function(){var _240=dojo.i18n.getLocalization("dijit","common");dojo.mixin(this,_240);this.inherited(arguments);},postCreate:function(){dojo.style(this.domNode,{display:"none",position:"absolute"});dojo.body().appendChild(this.domNode);this.inherited(arguments);this.connect(this,"onExecute","hide");this.connect(this,"onCancel","hide");this._modalconnects=[];},onLoad:function(){this._position();if(this.autofocus){this._getFocusItems(this.domNode);dijit.focus(this._firstFocusItem);}this.inherited(arguments);},_endDrag:function(e){if(e&&e.node&&e.node===this.domNode){this._relativePosition=dojo.position(e.node);}},_setup:function(){var node=this.domNode;if(this.titleBar&&this.draggable){this._moveable=(dojo.isIE==6)?new dojo.dnd.TimedMoveable(node,{handle:this.titleBar}):new dojo.dnd.Moveable(node,{handle:this.titleBar,timeout:0});this._dndListener=dojo.subscribe("/dnd/move/stop",this,"_endDrag");}else{dojo.addClass(node,"dijitDialogFixed");}this.underlayAttrs={dialogId:this.id,"class":dojo.map(this["class"].split(/\s/),function(s){return s+"_underlay";}).join(" ")};this._fadeIn=dojo.fadeIn({node:node,duration:this.duration,beforeBegin:dojo.hitch(this,function(){var _241=dijit._underlay;if(!_241){_241=dijit._underlay=new dijit.DialogUnderlay(this.underlayAttrs);}else{_241.set(this.underlayAttrs);}var ds=dijit._dialogStack,_242=948+ds.length*2;if(ds.length==1){_241.show();}dojo.style(dijit._underlay.domNode,"zIndex",_242);dojo.style(this.domNode,"zIndex",_242+1);}),onEnd:dojo.hitch(this,function(){if(this.autofocus){this._getFocusItems(this.domNode);dijit.focus(this._firstFocusItem);}})});this._fadeOut=dojo.fadeOut({node:node,duration:this.duration,onEnd:dojo.hitch(this,function(){node.style.display="none";var ds=dijit._dialogStack;if(ds.length==0){dijit._underlay.hide();}else{dojo.style(dijit._underlay.domNode,"zIndex",948+ds.length*2);dijit._underlay.set(ds[ds.length-1].underlayAttrs);}if(this.refocus){var _243=this._savedFocus;if(ds.length>0){var pd=ds[ds.length-1];if(!dojo.isDescendant(_243.node,pd.domNode)){pd._getFocusItems(pd.domNode);_243=pd._firstFocusItem;}}dijit.focus(_243);}})});},uninitialize:function(){var _244=false;if(this._fadeIn&&this._fadeIn.status()=="playing"){_244=true;this._fadeIn.stop();}if(this._fadeOut&&this._fadeOut.status()=="playing"){_244=true;this._fadeOut.stop();}if((this.open||_244)&&!dijit._underlay._destroyed){dijit._underlay.hide();}if(this._moveable){this._moveable.destroy();}this.inherited(arguments);},_size:function(){this._checkIfSingleChild();if(this._singleChild){if(this._singleChildOriginalStyle){this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;}delete this._singleChildOriginalStyle;}else{dojo.style(this.containerNode,{width:"auto",height:"auto"});}var mb=dojo.marginBox(this.domNode);var _245=dojo.window.getBox();if(mb.w>=_245.w||mb.h>=_245.h){var w=Math.min(mb.w,Math.floor(_245.w*0.75)),h=Math.min(mb.h,Math.floor(_245.h*0.75));if(this._singleChild&&this._singleChild.resize){this._singleChildOriginalStyle=this._singleChild.domNode.style.cssText;this._singleChild.resize({w:w,h:h});}else{dojo.style(this.containerNode,{width:w+"px",height:h+"px",overflow:"auto",position:"relative"});}}else{if(this._singleChild&&this._singleChild.resize){this._singleChild.resize();}}},_position:function(){if(!dojo.hasClass(dojo.body(),"dojoMove")){var node=this.domNode,_246=dojo.window.getBox(),p=this._relativePosition,bb=p?null:dojo._getBorderBox(node),l=Math.floor(_246.l+(p?p.x:(_246.w-bb.w)/2)),t=Math.floor(_246.t+(p?p.y:(_246.h-bb.h)/2));dojo.style(node,{left:l+"px",top:t+"px"});}},_onKey:function(evt){var ds=dijit._dialogStack;if(ds[ds.length-1]!=this){return;}if(evt.charOrCode){var dk=dojo.keys;var node=evt.target;if(evt.charOrCode===dk.TAB){this._getFocusItems(this.domNode);}var _247=(this._firstFocusItem==this._lastFocusItem);if(node==this._firstFocusItem&&evt.shiftKey&&evt.charOrCode===dk.TAB){if(!_247){dijit.focus(this._lastFocusItem);}dojo.stopEvent(evt);}else{if(node==this._lastFocusItem&&evt.charOrCode===dk.TAB&&!evt.shiftKey){if(!_247){dijit.focus(this._firstFocusItem);}dojo.stopEvent(evt);}else{while(node){if(node==this.domNode||dojo.hasClass(node,"dijitPopup")){if(evt.charOrCode==dk.ESCAPE){this.onCancel();}else{return;}}node=node.parentNode;}if(evt.charOrCode!==dk.TAB){dojo.stopEvent(evt);}else{if(!dojo.isOpera){try{this._firstFocusItem.focus();}catch(e){}}}}}}},show:function(){if(this.open){return;}if(!this._alreadyInitialized){this._setup();this._alreadyInitialized=true;}if(this._fadeOut.status()=="playing"){this._fadeOut.stop();}this._modalconnects.push(dojo.connect(window,"onscroll",this,"layout"));this._modalconnects.push(dojo.connect(window,"onresize",this,function(){var _248=dojo.window.getBox();if(!this._oldViewport||_248.h!=this._oldViewport.h||_248.w!=this._oldViewport.w){this.layout();this._oldViewport=_248;}}));this._modalconnects.push(dojo.connect(dojo.doc.documentElement,"onkeypress",this,"_onKey"));dojo.style(this.domNode,{opacity:0,display:""});this.open=true;this._onShow();this._size();this._position();dijit._dialogStack.push(this);this._fadeIn.play();this._savedFocus=dijit.getFocus(this);},hide:function(){var ds=dijit._dialogStack;if(!this._alreadyInitialized||this!=ds[ds.length-1]){return;}if(this._fadeIn.status()=="playing"){this._fadeIn.stop();}ds.pop();this._fadeOut.play();if(this._scrollConnected){this._scrollConnected=false;}dojo.forEach(this._modalconnects,dojo.disconnect);this._modalconnects=[];if(this._relativePosition){delete this._relativePosition;}this.open=false;this.onHide();},layout:function(){if(this.domNode.style.display!="none"){if(dijit._underlay){dijit._underlay.layout();}this._position();}},destroy:function(){dojo.forEach(this._modalconnects,dojo.disconnect);if(this.refocus&&this.open){setTimeout(dojo.hitch(dijit,"focus",this._savedFocus),25);}if(this._dndListener){dojo.unsubscribe(this._dndListener);}this.inherited(arguments);}});dojo.declare("dijit.Dialog",[dijit.layout.ContentPane,dijit._DialogBase],{});dijit._dialogStack=[];}if(!dojo._hasResource["dojox.string.Builder"]){dojo._hasResource["dojox.string.Builder"]=true;dojo.provide("dojox.string.Builder");dojox.string.Builder=function(str){var b="";this.length=0;this.append=function(s){if(arguments.length>1){var tmp="",l=arguments.length;switch(l){case 9:tmp=""+arguments[8]+tmp;case 8:tmp=""+arguments[7]+tmp;case 7:tmp=""+arguments[6]+tmp;case 6:tmp=""+arguments[5]+tmp;case 5:tmp=""+arguments[4]+tmp;case 4:tmp=""+arguments[3]+tmp;case 3:tmp=""+arguments[2]+tmp;case 2:b+=""+arguments[0]+arguments[1]+tmp;break;default:var i=0;while(i<arguments.length){tmp+=arguments[i++];}b+=tmp;}}else{b+=s;}this.length=b.length;return this;};this.concat=function(s){return this.append.apply(this,arguments);};this.appendArray=function(_249){return this.append.apply(this,_249);};this.clear=function(){b="";this.length=0;return this;};this.replace=function(_24a,_24b){b=b.replace(_24a,_24b);this.length=b.length;return this;};this.remove=function(_24c,len){if(len===undefined){len=b.length;}if(len==0){return this;}b=b.substr(0,_24c)+b.substr(_24c+len);this.length=b.length;return this;};this.insert=function(_24d,str){if(_24d==0){b=str+b;}else{b=b.slice(0,_24d)+str+b.slice(_24d);}this.length=b.length;return this;};this.toString=function(){return b;};if(str){this.append(str);}};}if(!dojo._hasResource["dojox.string.tokenize"]){dojo._hasResource["dojox.string.tokenize"]=true;dojo.provide("dojox.string.tokenize");dojox.string.tokenize=function(str,re,_24e,_24f){var _250=[];var _251,_252,_253=0;while(_251=re.exec(str)){_252=str.slice(_253,re.lastIndex-_251[0].length);if(_252.length){_250.push(_252);}if(_24e){if(dojo.isOpera){var copy=_251.slice(0);while(copy.length<_251.length){copy.push(null);}_251=copy;}var _254=_24e.apply(_24f,_251.slice(1).concat(_250.length));if(typeof _254!="undefined"){_250.push(_254);}}_253=re.lastIndex;}_252=str.slice(_253);if(_252.length){_250.push(_252);}return _250;};}if(!dojo._hasResource["dojox.dtl._base"]){dojo._hasResource["dojox.dtl._base"]=true;dojo.provide("dojox.dtl._base");dojo.experimental("dojox.dtl");(function(){var dd=dojox.dtl;dd.TOKEN_BLOCK=-1;dd.TOKEN_VAR=-2;dd.TOKEN_COMMENT=-3;dd.TOKEN_TEXT=3;dd._Context=dojo.extend(function(dict){if(dict){dojo._mixin(this,dict);if(dict.get){this._getter=dict.get;delete this.get;}}},{push:function(){var last=this;var _255=dojo.delegate(this);_255.pop=function(){return last;};return _255;},pop:function(){throw new Error("pop() called on empty Context");},get:function(key,_256){var n=this._normalize;if(this._getter){var got=this._getter(key);if(typeof got!="undefined"){return n(got);}}if(typeof this[key]!="undefined"){return n(this[key]);}return _256;},_normalize:function(_257){if(_257 instanceof Date){_257.year=_257.getFullYear();_257.month=_257.getMonth()+1;_257.day=_257.getDate();_257.date=_257.year+"-"+("0"+_257.month).slice(-2)+"-"+("0"+_257.day).slice(-2);_257.hour=_257.getHours();_257.minute=_257.getMinutes();_257.second=_257.getSeconds();_257.microsecond=_257.getMilliseconds();}return _257;},update:function(dict){var _258=this.push();if(dict){dojo._mixin(this,dict);}return _258;}});var _259=/("(?:[^"\\]*(?:\\.[^"\\]*)*)"|'(?:[^'\\]*(?:\\.[^'\\]*)*)'|[^\s]+)/g;var _25a=/\s+/g;var _25b=function(_25c,_25d){_25c=_25c||_25a;if(!(_25c instanceof RegExp)){_25c=new RegExp(_25c,"g");}if(!_25c.global){throw new Error("You must use a globally flagged RegExp with split "+_25c);}_25c.exec("");var part,_25e=[],_25f=0,i=0;while(part=_25c.exec(this)){_25e.push(this.slice(_25f,_25c.lastIndex-part[0].length));_25f=_25c.lastIndex;if(_25d&&(++i>_25d-1)){break;}}_25e.push(this.slice(_25f));return _25e;};dd.Token=function(_260,_261){this.token_type=_260;this.contents=new String(dojo.trim(_261));this.contents.split=_25b;this.split=function(){return String.prototype.split.apply(this.contents,arguments);};};dd.Token.prototype.split_contents=function(_262){var bit,bits=[],i=0;_262=_262||999;while(i++<_262&&(bit=_259.exec(this.contents))){bit=bit[0];if(bit.charAt(0)=="\""&&bit.slice(-1)=="\""){bits.push("\""+bit.slice(1,-1).replace("\\\"","\"").replace("\\\\","\\")+"\"");}else{if(bit.charAt(0)=="'"&&bit.slice(-1)=="'"){bits.push("'"+bit.slice(1,-1).replace("\\'","'").replace("\\\\","\\")+"'");}else{bits.push(bit);}}}return bits;};var ddt=dd.text={_get:function(_263,name,_264){var _265=dd.register.get(_263,name.toLowerCase(),_264);if(!_265){if(!_264){throw new Error("No tag found for "+name);}return null;}var fn=_265[1];var _266=_265[2];var _267;if(fn.indexOf(":")!=-1){_267=fn.split(":");fn=_267.pop();}dojo["require"](_266);var _268=dojo.getObject(_266);return _268[fn||name]||_268[name+"_"]||_268[fn+"_"];},getTag:function(name,_269){return ddt._get("tag",name,_269);},getFilter:function(name,_26a){return ddt._get("filter",name,_26a);},getTemplate:function(file){return new dd.Template(ddt.getTemplateString(file));},getTemplateString:function(file){return dojo._getText(file.toString())||"";},_resolveLazy:function(_26b,sync,json){if(sync){if(json){return dojo.fromJson(dojo._getText(_26b))||{};}else{return dd.text.getTemplateString(_26b);}}else{return dojo.xhrGet({handleAs:(json)?"json":"text",url:_26b});}},_resolveTemplateArg:function(arg,sync){if(ddt._isTemplate(arg)){if(!sync){var d=new dojo.Deferred();d.callback(arg);return d;}return arg;}return ddt._resolveLazy(arg,sync);},_isTemplate:function(arg){return (typeof arg=="undefined")||(typeof arg=="string"&&(arg.match(/^\s*[<{]/)||arg.indexOf(" ")!=-1));},_resolveContextArg:function(arg,sync){if(arg.constructor==Object){if(!sync){var d=new dojo.Deferred;d.callback(arg);return d;}return arg;}return ddt._resolveLazy(arg,sync,true);},_re:/(?:\{\{\s*(.+?)\s*\}\}|\{%\s*(load\s*)?(.+?)\s*%\})/g,tokenize:function(str){return dojox.string.tokenize(str,ddt._re,ddt._parseDelims);},_parseDelims:function(varr,load,tag){if(varr){return [dd.TOKEN_VAR,varr];}else{if(load){var _26c=dojo.trim(tag).split(/\s+/g);for(var i=0,part;part=_26c[i];i++){dojo["require"](part);}}else{return [dd.TOKEN_BLOCK,tag];}}}};dd.Template=dojo.extend(function(_26d,_26e){var str=_26e?_26d:ddt._resolveTemplateArg(_26d,true)||"";var _26f=ddt.tokenize(str);var _270=new dd._Parser(_26f);this.nodelist=_270.parse();},{update:function(node,_271){return ddt._resolveContextArg(_271).addCallback(this,function(_272){var _273=this.render(new dd._Context(_272));if(node.forEach){node.forEach(function(item){item.innerHTML=_273;});}else{dojo.byId(node).innerHTML=_273;}return this;});},render:function(_274,_275){_275=_275||this.getBuffer();_274=_274||new dd._Context({});return this.nodelist.render(_274,_275)+"";},getBuffer:function(){return new dojox.string.Builder();}});var qfRe=/\{\{\s*(.+?)\s*\}\}/g;dd.quickFilter=function(str){if(!str){return new dd._NodeList();}if(str.indexOf("{%")==-1){return new dd._QuickNodeList(dojox.string.tokenize(str,qfRe,function(_276){return new dd._Filter(_276);}));}};dd._QuickNodeList=dojo.extend(function(_277){this.contents=_277;},{render:function(_278,_279){for(var i=0,l=this.contents.length;i<l;i++){if(this.contents[i].resolve){_279=_279.concat(this.contents[i].resolve(_278));}else{_279=_279.concat(this.contents[i]);}}return _279;},dummyRender:function(_27a){return this.render(_27a,dd.Template.prototype.getBuffer()).toString();},clone:function(_27b){return this;}});dd._Filter=dojo.extend(function(_27c){if(!_27c){throw new Error("Filter must be called with variable name");}this.contents=_27c;var _27d=this._cache[_27c];if(_27d){this.key=_27d[0];this.filters=_27d[1];}else{this.filters=[];dojox.string.tokenize(_27c,this._re,this._tokenize,this);this._cache[_27c]=[this.key,this.filters];}},{_cache:{},_re:/(?:^_\("([^\\"]*(?:\\.[^\\"])*)"\)|^"([^\\"]*(?:\\.[^\\"]*)*)"|^([a-zA-Z0-9_.]+)|\|(\w+)(?::(?:_\("([^\\"]*(?:\\.[^\\"])*)"\)|"([^\\"]*(?:\\.[^\\"]*)*)"|([a-zA-Z0-9_.]+)|'([^\\']*(?:\\.[^\\']*)*)'))?|^'([^\\']*(?:\\.[^\\']*)*)')/g,_values:{0:"\"",1:"\"",2:"",8:"\""},_args:{4:"\"",5:"\"",6:"",7:"'"},_tokenize:function(){var pos,arg;for(var i=0,has=[];i<arguments.length;i++){has[i]=(typeof arguments[i]!="undefined"&&typeof arguments[i]=="string"&&arguments[i]);}if(!this.key){for(pos in this._values){if(has[pos]){this.key=this._values[pos]+arguments[pos]+this._values[pos];break;}}}else{for(pos in this._args){if(has[pos]){var _27e=arguments[pos];if(this._args[pos]=="'"){_27e=_27e.replace(/\\'/g,"'");}else{if(this._args[pos]=="\""){_27e=_27e.replace(/\\"/g,"\"");}}arg=[!this._args[pos],_27e];break;}}var fn=ddt.getFilter(arguments[3]);if(!dojo.isFunction(fn)){throw new Error(arguments[3]+" is not registered as a filter");}this.filters.push([fn,arg]);}},getExpression:function(){return this.contents;},resolve:function(_27f){if(typeof this.key=="undefined"){return "";}var str=this.resolvePath(this.key,_27f);for(var i=0,_280;_280=this.filters[i];i++){if(_280[1]){if(_280[1][0]){str=_280[0](str,this.resolvePath(_280[1][1],_27f));}else{str=_280[0](str,_280[1][1]);}}else{str=_280[0](str);}}return str;},resolvePath:function(path,_281){var _282,_283;var _284=path.charAt(0);var last=path.slice(-1);if(!isNaN(parseInt(_284))){_282=(path.indexOf(".")==-1)?parseInt(path):parseFloat(path);}else{if(_284=="\""&&_284==last){_282=path.slice(1,-1);}else{if(path=="true"){return true;}if(path=="false"){return false;}if(path=="null"||path=="None"){return null;}_283=path.split(".");_282=_281.get(_283[0]);if(dojo.isFunction(_282)){var self=_281.getThis&&_281.getThis();if(_282.alters_data){_282="";}else{if(self){_282=_282.call(self);}else{_282="";}}}for(var i=1;i<_283.length;i++){var part=_283[i];if(_282){var base=_282;if(dojo.isObject(_282)&&part=="items"&&typeof _282[part]=="undefined"){var _285=[];for(var key in _282){_285.push([key,_282[key]]);}_282=_285;continue;}if(_282.get&&dojo.isFunction(_282.get)&&_282.get.safe){_282=_282.get(part);}else{if(typeof _282[part]=="undefined"){_282=_282[part];break;}else{_282=_282[part];}}if(dojo.isFunction(_282)){if(_282.alters_data){_282="";}else{_282=_282.call(base);}}else{if(_282 instanceof Date){_282=dd._Context.prototype._normalize(_282);}}}else{return "";}}}}return _282;}});dd._TextNode=dd._Node=dojo.extend(function(obj){this.contents=obj;},{set:function(data){this.contents=data;return this;},render:function(_286,_287){return _287.concat(this.contents);},isEmpty:function(){return !dojo.trim(this.contents);},clone:function(){return this;}});dd._NodeList=dojo.extend(function(_288){this.contents=_288||[];this.last="";},{push:function(node){this.contents.push(node);return this;},concat:function(_289){this.contents=this.contents.concat(_289);return this;},render:function(_28a,_28b){for(var i=0;i<this.contents.length;i++){_28b=this.contents[i].render(_28a,_28b);if(!_28b){throw new Error("Template must return buffer");}}return _28b;},dummyRender:function(_28c){return this.render(_28c,dd.Template.prototype.getBuffer()).toString();},unrender:function(){return arguments[1];},clone:function(){return this;},rtrim:function(){while(1){i=this.contents.length-1;if(this.contents[i] instanceof dd._TextNode&&this.contents[i].isEmpty()){this.contents.pop();}else{break;}}return this;}});dd._VarNode=dojo.extend(function(str){this.contents=new dd._Filter(str);},{render:function(_28d,_28e){var str=this.contents.resolve(_28d);if(!str.safe){str=dd._base.escape(""+str);}return _28e.concat(str);}});dd._noOpNode=new function(){this.render=this.unrender=function(){return arguments[1];};this.clone=function(){return this;};};dd._Parser=dojo.extend(function(_28f){this.contents=_28f;},{i:0,parse:function(_290){var _291={},_292;_290=_290||[];for(var i=0;i<_290.length;i++){_291[_290[i]]=true;}var _293=new dd._NodeList();while(this.i<this.contents.length){_292=this.contents[this.i++];if(typeof _292=="string"){_293.push(new dd._TextNode(_292));}else{var type=_292[0];var text=_292[1];if(type==dd.TOKEN_VAR){_293.push(new dd._VarNode(text));}else{if(type==dd.TOKEN_BLOCK){if(_291[text]){--this.i;return _293;}var cmd=text.split(/\s+/g);if(cmd.length){cmd=cmd[0];var fn=ddt.getTag(cmd);if(fn){_293.push(fn(this,new dd.Token(type,text)));}}}}}}if(_290.length){throw new Error("Could not find closing tag(s): "+_290.toString());}this.contents.length=0;return _293;},next_token:function(){var _294=this.contents[this.i++];return new dd.Token(_294[0],_294[1]);},delete_first_token:function(){this.i++;},skip_past:function(_295){while(this.i<this.contents.length){var _296=this.contents[this.i++];if(_296[0]==dd.TOKEN_BLOCK&&_296[1]==_295){return;}}throw new Error("Unclosed tag found when looking for "+_295);},create_variable_node:function(expr){return new dd._VarNode(expr);},create_text_node:function(expr){return new dd._TextNode(expr||"");},getTemplate:function(file){return new dd.Template(file);}});dd.register={_registry:{attributes:[],tags:[],filters:[]},get:function(_297,name){var _298=dd.register._registry[_297+"s"];for(var i=0,_299;_299=_298[i];i++){if(typeof _299[0]=="string"){if(_299[0]==name){return _299;}}else{if(name.match(_299[0])){return _299;}}}},getAttributeTags:function(){var tags=[];var _29a=dd.register._registry.attributes;for(var i=0,_29b;_29b=_29a[i];i++){if(_29b.length==3){tags.push(_29b);}else{var fn=dojo.getObject(_29b[1]);if(fn&&dojo.isFunction(fn)){_29b.push(fn);tags.push(_29b);}}}return tags;},_any:function(type,base,_29c){for(var path in _29c){for(var i=0,fn;fn=_29c[path][i];i++){var key=fn;if(dojo.isArray(fn)){key=fn[0];fn=fn[1];}if(typeof key=="string"){if(key.substr(0,5)=="attr:"){var attr=fn;if(attr.substr(0,5)=="attr:"){attr=attr.slice(5);}dd.register._registry.attributes.push([attr.toLowerCase(),base+"."+path+"."+attr]);}key=key.toLowerCase();}dd.register._registry[type].push([key,fn,base+"."+path]);}}},tags:function(base,_29d){dd.register._any("tags",base,_29d);},filters:function(base,_29e){dd.register._any("filters",base,_29e);}};var _29f=/&/g;var _2a0=/</g;var _2a1=/>/g;var _2a2=/'/g;var _2a3=/"/g;dd._base.escape=function(_2a4){return dd.mark_safe(_2a4.replace(_29f,"&amp;").replace(_2a0,"&lt;").replace(_2a1,"&gt;").replace(_2a3,"&quot;").replace(_2a2,"&#39;"));};dd._base.safe=function(_2a5){if(typeof _2a5=="string"){_2a5=new String(_2a5);}if(typeof _2a5=="object"){_2a5.safe=true;}return _2a5;};dd.mark_safe=dd._base.safe;dd.register.tags("dojox.dtl.tag",{"date":["now"],"logic":["if","for","ifequal","ifnotequal"],"loader":["extends","block","include","load","ssi"],"misc":["comment","debug","filter","firstof","spaceless","templatetag","widthratio","with"],"loop":["cycle","ifchanged","regroup"]});dd.register.filters("dojox.dtl.filter",{"dates":["date","time","timesince","timeuntil"],"htmlstrings":["linebreaks","linebreaksbr","removetags","striptags"],"integers":["add","get_digit"],"lists":["dictsort","dictsortreversed","first","join","length","length_is","random","slice","unordered_list"],"logic":["default","default_if_none","divisibleby","yesno"],"misc":["filesizeformat","pluralize","phone2numeric","pprint"],"strings":["addslashes","capfirst","center","cut","fix_ampersands","floatformat","iriencode","linenumbers","ljust","lower","make_list","rjust","slugify","stringformat","title","truncatewords","truncatewords_html","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap"]});dd.register.filters("dojox.dtl",{"_base":["escape","safe"]});})();}if(!dojo._hasResource["dojox.dtl"]){dojo._hasResource["dojox.dtl"]=true;dojo.provide("dojox.dtl");}if(!dojo._hasResource["dojox.dtl.Context"]){dojo._hasResource["dojox.dtl.Context"]=true;dojo.provide("dojox.dtl.Context");dojox.dtl.Context=dojo.extend(function(dict){this._this={};dojox.dtl._Context.call(this,dict);},dojox.dtl._Context.prototype,{getKeys:function(){var keys=[];for(var key in this){if(this.hasOwnProperty(key)&&key!="_this"){keys.push(key);}}return keys;},extend:function(obj){return dojo.delegate(this,obj);},filter:function(_2a6){var _2a7=new dojox.dtl.Context();var keys=[];var i,arg;if(_2a6 instanceof dojox.dtl.Context){keys=_2a6.getKeys();}else{if(typeof _2a6=="object"){for(var key in _2a6){keys.push(key);}}else{for(i=0;arg=arguments[i];i++){if(typeof arg=="string"){keys.push(arg);}}}}for(i=0,key;key=keys[i];i++){_2a7[key]=this[key];}return _2a7;},setThis:function(_2a8){this._this=_2a8;},getThis:function(){return this._this;},hasKey:function(key){if(this._getter){var got=this._getter(key);if(typeof got!="undefined"){return true;}}if(typeof this[key]!="undefined"){return true;}return false;}});}if(!dojo._hasResource["depot.ProductController"]){dojo._hasResource["depot.ProductController"]=true;dojo.provide("depot.ProductController");dojo.registerModulePath("product","../../product");dojo.declare("depot.ProductController",null,{defaultOrder:null,constructor:function(){this.defaultOrder={identifier:"productId",label:"product.name",items:[]};},loadCatalog:function(){var _2a9={url:"jaxrs/Category",handleAs:"json",load:dojo.hitch(this,this.loadCatalogSuccess),error:dojo.hitch(this,this.loadCatalogError)};dojo.xhrGet(_2a9);this.cartPreview();dojo.connect(dijit.byId("productGrid"),"onRowClick",this,this.dragAndDrop);dojo.subscribe("/dnd/drop",this,this.addToCart);},loadCatalogSuccess:function(data,_2aa){var menu=dijit.byId("categoryMenu");dojo.forEach(data,dojo.hitch(this,function(item){if(item.subCategories){var _2ab=new dijit.Menu({parentMenu:menu});dojo.addClass(_2ab,"outer");dojo.forEach(item.subCategories,dojo.hitch(this,function(_2ac){var _2ad=new dijit.MenuItem({label:_2ac.name,title:_2ac.id});dojo.connect(_2ad,"onClick",this,this.selectCategory);_2ab.addChild(_2ad);}));var _2ae=new dijit.PopupMenuItem({label:item.name,popup:_2ab});menu.addChild(_2ae);}}));},loadCatalogError:function(e){console.error("Error Loading Categories",e);},formatImage:function(item){return dojo.replace("<img  src='{image}' height='100px' width='100px'></img>",{image:item});},combineData:function(_2af,item){return item;},formatData:function(item){return dojo.replace("<div class='productTitle'>{name}</div><div>{price}</div>",item);},selectCategory:function(_2b0){var grid=dijit.byId("productGrid");grid.setQuery({categoryId:_2b0.target.parentNode.title});dojo.place("<div>"+_2b0.target.innerHTML+"</div>","catHeader","only");},cartPreview:function(){if(accountController.account.openOrder){this.defaultOrder.items=accountController.account.openOrder.lineitems;dojo.forEach(this.defaultOrder.items,function(item){try{previewStore.newItem(item);}catch(e){previewStore.fetchItemByIdentity({identity:item.productId,onItem:function(_2b1){previewStore.setValue(_2b1,"quantity",item.quantity);}});}});previewStore.save();dojo.place("<div>Order Total: "+accountController.account.openOrder.total+"</div>","orderTotal","only");}},dragAndDrop:function(){var _2b2=dijit.byId("detailDialog");var grid=dijit.byId("productGrid");console.debug(arguments[0]);var item=grid.getItem(arguments[0].rowIndex);console.debug(item);_2b2.set("title",item.name);var _2b3=new dojox.dtl.Template(dojo.moduleUrl("product","productDetail.html"));var _2b4=new dojox.dtl.Context(item);dijit.byId("detailDialogPane").set("content",_2b3.render(_2b4));dojo.query(".progressSection").style({display:"none"});dojo.query(".cartSection").style({display:"block"});dojo.query(".productSection").style({display:"block"});_2b2.show();},addToCart:function(data){var grid=dijit.byId("productGrid");console.debug(grid);var _2b5=grid.selection.getSelected();console.debug("Adding to Cart",_2b5);console.debug(_2b5[0].id);dojo.query(".progressSection").style({display:"block"});dojo.query(".cartSection").style({display:"none"});dojo.query(".productSection").style({display:"none"});var _2b6={url:"jaxrs/Customer/OpenOrder/LineItem",headers:{"Content-Type":"application/json","If-Match":accountController.etag},postData:dojo.toJson({quantity:1,productId:_2b5[0].id}),handleAs:"json",load:dojo.hitch(this,this.addToCartSuccess),error:dojo.hitch(this,this.addToCartError)};dojo.xhrPost(_2b6);},addToCartSuccess:function(data,_2b7){accountController.account.openOrder=data;this.defaultOrder.items=[];accountController.etag=_2b7.xhr.getResponseHeader("ETag");console.debug("Restting preview store");this.cartPreview();var _2b8=dijit.byId("detailDialog");_2b8.hide();},addToCartError:function(_2b9){console.debug(_2b9);},removeItem:function(e){console.info("remove item not implemented",e);},updateItem:function(e){console.info("update quantity not implemented",e);}});}dojo.i18n._preloadLocalizations("dojo.nls.depot_product",["ROOT","ar","ca","cs","da","de","de-de","el","en","en-gb","en-us","es","es-es","fi","fi-fi","fr","fr-fr","he","he-il","hu","it","it-it","ja","ja-jp","ko","ko-kr","nb","nl","nl-nl","pl","pt","pt-br","pt-pt","ru","sk","sl","sv","th","tr","xx","zh","zh-cn","zh-tw"]);

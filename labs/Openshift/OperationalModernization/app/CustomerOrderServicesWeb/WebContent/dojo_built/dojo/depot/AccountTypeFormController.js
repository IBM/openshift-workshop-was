/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["depot.AccountTypeFormController"]){dojo._hasResource["depot.AccountTypeFormController"]=true;dojo.provide("depot.AccountTypeFormController");dojo.require("dijit.form.Form");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit.form.Textarea");dojo.require("dojox.form.BusyButton");dojo.require("dojox.dtl");dojo.require("dojox.dtl.Context");dojo.require("dijit.form.NumberSpinner");dojo.declare("depot.AccountTypeFormController",null,{template:null,constructor:function(){this.getMetaData();},getMetaData:function(){var _1={url:"jaxrs/Customer/TypeForm",handleAs:"json",load:dojo.hitch(this,this.setAccount),error:dojo.hitch(this,this.loadAccountTypeError)};dojo.xhrGet(_1);},setAccount:function(_2){if(!this.template){this.template=new dojox.dtl.Template(dojo.moduleUrl("account","accountType.html"));}var _3=new dojox.dtl.Context({group:_2});dijit.byId("typeFormTile").set("content",this.template.render(_3));dijit.byId("typeFormTile").set("title",_2.label);if(accountController.account){dijit.byId("typeForm").set("value",accountController.account);}dojo.connect(dijit.byId("updateTypeButton"),"onClick",this,this.updateAccountType);dojo.query(".formValue","typeForm").forEach(dojo.hitch(this,function(_4){dojo.connect(_4,"onchange",this,this.isValid);dojo.connect(_4,"onkeyup",this,this.isValid);}));},loadAccountTypeError:function(_5){console.error(_5);},updateAccountType:function(){dijit.byId("updateTypeButton").makeBusy();var _6={"type":accountController.account.type};_6=dojo.mixin(_6,dijit.byId("typeForm").get("value"));var _7={url:"jaxrs/Customer/Info",headers:{"Content-Type":"application/json"},postData:dojo.toJson(_6),load:dojo.hitch(this,this.updateTypeSuccess),error:dojo.hitch(this,this.updateTypeError)};dojo.xhrPost(_7);},updateTypeSuccess:function(_8){dijit.byId("updateTypeButton").cancel();dojo.place("<div class='successMessage'>Update Succesful</div>","resultType","only");},updateTypeError:function(_9){console.error(_9);dijit.byId("updateTypeButton").cancel();dojo.place("<div class='errorMessage'>Update Failed</div>","resultType","only");},isValid:function(){if(dijit.byId("typeForm").isValid()){dijit.byId("updateTypeButton").set("disabled",false);return true;}else{dijit.byId("updateTypeButton").set("disabled",true);return false;}}});}